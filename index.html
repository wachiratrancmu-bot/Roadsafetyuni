<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Road Safety Monitorâ€” à¸£à¸°à¸šà¸šà¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸—à¸²à¸‡à¸–à¸™à¸™ PSRU</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<style>
:root {
  /* Base */
  --white:     #ffffff;
  --bg:        #f4f6f9;
  --bg2:       #eef1f6;
  --surface:   #ffffff;
  --surface2:  #f7f9fc;
  --surface3:  #edf0f5;

  /* Borders */
  --border:    #d4dae4;
  --border2:   #b8c2d0;
  --divider:   #e8ecf1;

  /* Authority Blue â€” deep, institutional */
  --navy:      #1b3a6b;
  --navy-d:    #122b54;
  --navy-m:    #2653a0;
  --navy-l:    #e8edf7;
  --navy-xl:   #f0f4fb;

  /* Status colors â€” calibrated for severity */
  --red:       #c0392b;
  --red-m:     #e74c3c;
  --red-l:     #fdf0ef;
  --red-b:     #f9c9c5;

  --amber:     #b7560a;
  --amber-m:   #e67e22;
  --amber-l:   #fdf4ec;
  --amber-b:   #f7d9bc;

  --green:     #1a7a4a;
  --green-m:   #27ae60;
  --green-l:   #edf8f2;
  --green-b:   #b8e6cf;

  --blue:      #2563eb;
  --blue-l:    #eff6ff;
  --blue-b:    #bfdbfe;

  /* Text */
  --text:      #1a2332;
  --text-2:    #3d5168;
  --text-3:    #6b7f99;
  --text-4:    #9aaabb;

  /* Typography */
  --font:      'IBM Plex Sans Thai', sans-serif;
  --mono:      'IBM Plex Mono', monospace;

  /* Geometry */
  --r-xs:      4px;
  --r-sm:      6px;
  --r:         10px;
  --r-lg:      14px;
  --r-xl:      18px;

  /* Shadows â€” subtle, government-grade */
  --sh-xs:     0 1px 3px rgba(27,58,107,0.06);
  --sh:        0 2px 8px rgba(27,58,107,0.08), 0 1px 2px rgba(27,58,107,0.04);
  --sh-md:     0 4px 16px rgba(27,58,107,0.10), 0 1px 4px rgba(27,58,107,0.06);
  --sh-lg:     0 8px 32px rgba(27,58,107,0.12), 0 2px 8px rgba(27,58,107,0.06);
  --sh-panel:  0 -4px 24px rgba(27,58,107,0.10), 0 -1px 6px rgba(27,58,107,0.06);
}

*, *::before, *::after {
  margin: 0; padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html { height: 100%; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}


.header {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 56px;
  background: var(--navy);
  display: flex;
  align-items: center;
  padding: 0 16px;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-emblem {
  width: 32px;
  height: 32px;
  background: var(--white);
  border-radius: var(--r-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.header-emblem svg {
  width: 18px;
  height: 18px;
}

.header-wordmark {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.header-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--white);
  letter-spacing: 0.2px;
  line-height: 1.2;
}

.header-sub {
  font-size: 9.5px;
  font-weight: 400;
  color: rgba(255,255,255,0.6);
  letter-spacing: 0.3px;
  line-height: 1.2;
}

.header-counters {
  display: flex;
  align-items: center;
  gap: 2px;
  margin-left: auto;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: var(--r-sm);
  padding: 5px 10px;
}

.hcnt {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0 8px;
  border-right: 1px solid rgba(255,255,255,0.12);
}
.hcnt:last-child { border-right: none; }

.hcnt-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
}

.hcnt-n {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--white);
}

.hcnt-label {
  font-size: 10px;
  color: rgba(255,255,255,0.55);
  font-weight: 400;
}

.status-bar {
  position: fixed;
  top: 56px;
  left: 0; right: 0;
  height: 36px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 12px;
  gap: 8px;
  z-index: 990;
  box-shadow: var(--sh-xs);
}

.sb-live {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 10.5px;
  font-weight: 600;
  color: var(--green);
  letter-spacing: 0.3px;
}

.sb-live-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--green-m);
  animation: pulse 2.2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.85); }
}

.sb-separator {
  width: 1px;
  height: 16px;
  background: var(--divider);
}

.sb-mode-btns {
  display: flex;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  overflow: hidden;
}

.sb-mode-btn {
  padding: 4px 10px;
  font-family: var(--font);
  font-size: 10.5px;
  font-weight: 600;
  color: var(--text-3);
  background: none;
  border: none;
  border-right: 1px solid var(--border);
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.sb-mode-btn:last-child { border-right: none; }
.sb-mode-btn.active {
  background: var(--navy);
  color: var(--white);
}

.sb-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 6px;
}

.sb-user-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background: var(--navy-xl);
  border: 1px solid var(--navy-l);
  border-radius: var(--r-sm);
  cursor: pointer;
  font-family: var(--font);
  transition: all 0.15s;
}
.sb-user-btn:hover { background: var(--navy-l); }

.sb-user-avatar {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--navy);
  color: var(--white);
  font-size: 10px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sb-user-pts {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--navy);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#map {
  position: fixed;
  top: 92px;
  left: 0; right: 0;
  bottom: 60px;
  z-index: 1;
}

/* Leaflet custom styling */
.leaflet-container {
  font-family: var(--font) !important;
}

.leaflet-popup-content-wrapper {
  border-radius: var(--r) !important;
  box-shadow: var(--sh-md) !important;
  border: 1px solid var(--border) !important;
  padding: 0 !important;
}

.leaflet-popup-content {
  margin: 0 !important;
}

.leaflet-popup-tip-container {
  display: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP OVERLAY CONTROLS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.map-legend {
  position: fixed;
  bottom: 70px;
  left: 12px;
  background: rgba(255,255,255,0.95);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 10px 12px;
  z-index: 500;
  backdrop-filter: blur(8px);
  box-shadow: var(--sh-md);
}

.legend-title {
  font-size: 9px;
  font-weight: 700;
  color: var(--text-3);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 7px;
}

.legend-row {
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 4px;
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
}
.legend-row:last-child { margin-bottom: 0; }

.legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.map-fab-group {
  position: fixed;
  right: 12px;
  bottom: 70px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 500;
}

.map-fab {
  width: 44px;
  height: 44px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--sh-md);
  transition: all 0.15s;
  font-size: 17px;
  color: var(--text-2);
}
.map-fab:active { transform: scale(0.95); }

.map-fab-report {
  width: 48px;
  height: 48px;
  background: var(--navy);
  border-color: var(--navy-d);
  color: var(--white);
  font-size: 22px;
  font-weight: 900;
  border-radius: var(--r);
  box-shadow: 0 4px 16px rgba(27,58,107,0.35);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 60px;
  background: var(--surface);
  border-top: 1.5px solid var(--border);
  display: flex;
  z-index: 1000;
  box-shadow: 0 -2px 12px rgba(27,58,107,0.07);
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  background: none;
  border: none;
  cursor: pointer;
  font-family: var(--font);
  font-size: 9.5px;
  font-weight: 600;
  color: var(--text-4);
  transition: all 0.15s;
  padding-bottom: env(safe-area-inset-bottom);
  position: relative;
}

.nav-item.active {
  color: var(--navy);
}

.nav-item.active::after {
  content: '';
  position: absolute;
  top: 0; left: 25%; right: 25%;
  height: 2px;
  background: var(--navy);
  border-radius: 0 0 2px 2px;
}

.nav-icon {
  width: 28px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: transform 0.15s;
}

.nav-item.active .nav-icon {
  transform: translateY(-1px);
}

.nav-center-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  background: none;
  border: none;
  cursor: pointer;
  font-family: var(--font);
  font-size: 9.5px;
  font-weight: 700;
  color: var(--navy);
  padding-bottom: env(safe-area-inset-bottom);
}

.nav-center-icon {
  width: 40px;
  height: 32px;
  background: var(--navy);
  border-radius: var(--r-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--white);
  font-size: 18px;
  margin-top: -8px;
  box-shadow: 0 2px 10px rgba(27,58,107,0.3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OVERLAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(10,18,35,0.45);
  z-index: 1500;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}
.overlay.open {
  opacity: 1;
  pointer-events: all;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL SYSTEM â€” Bottom sheet
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: var(--surface);
  border-radius: var(--r-xl) var(--r-xl) 0 0;
  z-index: 1600;
  transform: translateY(100%);
  transition: transform 0.38s cubic-bezier(0.32, 0.72, 0, 1);
  display: flex;
  flex-direction: column;
  max-height: 93vh;
  box-shadow: var(--sh-panel);
  border-top: 1px solid var(--border);
}

.panel.open {
  transform: translateY(0);
}

.panel-handle-wrap {
  display: flex;
  justify-content: center;
  padding: 10px 0 0;
  flex-shrink: 0;
}

.panel-handle {
  width: 38px;
  height: 4px;
  background: var(--border2);
  border-radius: 2px;
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 18px 8px;
  border-bottom: 1px solid var(--divider);
  flex-shrink: 0;
}

.panel-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.panel-header-icon {
  width: 34px;
  height: 34px;
  background: var(--navy-xl);
  border: 1px solid var(--navy-l);
  border-radius: var(--r-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.panel-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  line-height: 1.2;
}

.panel-subtitle {
  font-size: 11px;
  color: var(--text-3);
  font-weight: 400;
  margin-top: 1px;
}

.panel-close {
  width: 30px;
  height: 30px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 13px;
  color: var(--text-3);
  transition: all 0.15s;
  flex-shrink: 0;
}
.panel-close:hover {
  background: var(--surface3);
  color: var(--text);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIZARD STEPPER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wizard-stepper {
  padding: 14px 18px 0;
  flex-shrink: 0;
}

.step-track {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.step-node {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  flex-shrink: 0;
  transition: all 0.25s;
  border: 2px solid var(--border2);
  background: var(--surface);
  color: var(--text-3);
  z-index: 1;
}

.step-node.done {
  background: var(--navy);
  border-color: var(--navy);
  color: var(--white);
}

.step-node.active {
  background: var(--navy);
  border-color: var(--navy);
  color: var(--white);
  box-shadow: 0 0 0 4px rgba(27,58,107,0.12);
}

.step-connector {
  flex: 1;
  height: 2px;
  background: var(--border);
  margin: 0 4px;
  transition: background 0.3s;
  border-radius: 1px;
}
.step-connector.done {
  background: var(--navy);
}

.step-info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--divider);
}

.step-label-current {
  font-size: 12px;
  font-weight: 700;
  color: var(--navy);
  letter-spacing: 0.1px;
}

.step-counter {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-4);
  font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL BODY / SCROLL AREA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel-body {
  flex: 1;
  overflow-y: auto;
  padding: 0 18px 160px;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}
.panel-body::-webkit-scrollbar { display: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM COMPONENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Section label â€” à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¹à¸•à¹ˆà¸¥à¸°à¸«à¸±à¸§à¸‚à¹‰à¸­ */
.field-section {
  margin-top: 20px;
  margin-bottom: 10px;
}

.field-label {
  display: block;
  font-size: 11px;
  font-weight: 700;
  color: var(--navy);
  text-transform: uppercase;
  letter-spacing: 0.7px;
  margin-bottom: 3px;
}

.field-label .req {
  color: var(--red);
  margin-left: 3px;
}

.field-desc {
  font-size: 11.5px;
  color: var(--text-3);
  font-weight: 400;
  line-height: 1.4;
}

/* â”€â”€ OPTION CARDS â”€â”€ */
/* Event type â€” full width rows */
.event-options {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.event-opt {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 13px 14px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--r);
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
  width: 100%;
  font-family: var(--font);
}

.event-opt:active { transform: scale(0.99); }

.event-opt-icon {
  width: 40px;
  height: 40px;
  border-radius: var(--r-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.event-opt-text { flex: 1; }

.event-opt-title {
  font-size: 13.5px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 2px;
}

.event-opt-desc {
  font-size: 11.5px;
  color: var(--text-3);
  line-height: 1.35;
}

.event-opt-badge {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid var(--border);
  flex-shrink: 0;
  transition: all 0.15s;
}

/* Severity-specific colors */
.event-opt[data-sev="accident"] { border-left: 4px solid var(--red-m); }
.event-opt[data-sev="frequent"] { border-left: 4px solid var(--amber-m); }
.event-opt[data-sev="near"]     { border-left: 4px solid var(--green-m); }
.event-opt[data-sev="observe"]  { border-left: 4px solid var(--navy-m); }

.event-opt[data-sev="accident"] .event-opt-icon { background: var(--red-l); }
.event-opt[data-sev="frequent"] .event-opt-icon { background: var(--amber-l); }
.event-opt[data-sev="near"]     .event-opt-icon { background: var(--green-l); }
.event-opt[data-sev="observe"]  .event-opt-icon { background: var(--navy-xl); }

.event-opt.selected[data-sev="accident"] {
  background: var(--red-l);
  border-color: var(--red-m);
  border-left: 4px solid var(--red);
}
.event-opt.selected[data-sev="frequent"] {
  background: var(--amber-l);
  border-color: var(--amber-m);
  border-left: 4px solid var(--amber);
}
.event-opt.selected[data-sev="near"] {
  background: var(--green-l);
  border-color: var(--green-m);
  border-left: 4px solid var(--green);
}
.event-opt.selected[data-sev="observe"] {
  background: var(--navy-xl);
  border-color: var(--navy-m);
  border-left: 4px solid var(--navy);
}
.event-opt.selected .event-opt-badge {
  background: currentColor;
  border-color: currentColor;
}

/* Injury severity sub-section */
.injury-section {
  display: none;
  margin-top: 14px;
  padding: 14px;
  background: var(--red-l);
  border: 1px solid var(--red-b);
  border-radius: var(--r);
}
.injury-section.visible { display: block; }
.injury-section .field-label { color: var(--red); }

/* â”€â”€ GRID OPTIONS â”€â”€ (à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›) */
.opts-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; }
.opts-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 7px; }
.opts-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; }

.opt-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
  padding: 11px 6px 9px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--r-sm);
  cursor: pointer;
  transition: all 0.13s;
  font-family: var(--font);
  font-size: 11.5px;
  font-weight: 500;
  color: var(--text-2);
  text-align: center;
  line-height: 1.25;
  -webkit-user-select: none;
  user-select: none;
}

.opt-card-icon {
  font-size: 22px;
  line-height: 1;
}

.opt-card:active { transform: scale(0.97); }

.opt-card.selected {
  border-color: var(--navy);
  background: var(--navy-xl);
  color: var(--navy);
  font-weight: 700;
}

.opt-card.selected-red {
  border-color: var(--red);
  background: var(--red-l);
  color: var(--red);
  font-weight: 700;
}

/* â”€â”€ HORIZONTAL PILL OPTIONS â”€â”€ (time of day etc.) */
.pill-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.pill-opt {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 7px 12px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 100px;
  cursor: pointer;
  font-family: var(--font);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-2);
  transition: all 0.13s;
  white-space: nowrap;
  -webkit-user-select: none;
  user-select: none;
}
.pill-opt:active { transform: scale(0.97); }
.pill-opt.selected {
  background: var(--navy);
  border-color: var(--navy);
  color: var(--white);
  font-weight: 600;
}

/* â”€â”€ GPS / COORDINATE ROW â”€â”€ */
.gps-row {
  display: flex;
  gap: 8px;
  align-items: stretch;
}

.gps-btn {
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 10px 14px;
  background: var(--blue-l);
  border: 1.5px solid var(--blue-b);
  border-radius: var(--r-sm);
  color: var(--blue);
  font-family: var(--font);
  font-size: 12.5px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
  flex-shrink: 0;
}
.gps-btn:active { background: #dbeafe; }
.gps-btn.loading { opacity: 0.7; pointer-events: none; }

.coord-display {
  flex: 1;
  padding: 9px 12px;
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: var(--r-sm);
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-4);
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 0;
}
.coord-display.set {
  border-color: var(--green-m);
  color: var(--green);
  background: var(--green-l);
}

.coord-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

.map-tap-hint {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  font-size: 11px;
  color: var(--text-4);
  padding: 5px 0;
}

/* â”€â”€ FORM INPUTS â”€â”€ */
.form-input {
  width: 100%;
  padding: 10px 13px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--r-sm);
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  outline: none;
  transition: border-color 0.15s;
}
.form-input:focus { border-color: var(--navy); }
.form-input::placeholder { color: var(--text-4); }

.form-textarea {
  width: 100%;
  padding: 10px 13px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--r-sm);
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  outline: none;
  resize: none;
  min-height: 88px;
  line-height: 1.6;
  transition: border-color 0.15s;
}
.form-textarea:focus { border-color: var(--navy); }
.form-textarea::placeholder { color: var(--text-4); }

/* â”€â”€ PHOTO UPLOAD â”€â”€ */
.photo-upload-zone {
  border: 2px dashed var(--border2);
  border-radius: var(--r);
  padding: 22px 16px;
  text-align: center;
  cursor: pointer;
  background: var(--surface2);
  transition: all 0.2s;
}
.photo-upload-zone:hover {
  border-color: var(--navy);
  background: var(--navy-xl);
}
.photo-upload-zone input { display: none; }

.photo-upload-icon { font-size: 28px; margin-bottom: 6px; opacity: 0.6; }
.photo-upload-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-2);
  margin-bottom: 3px;
}
.photo-upload-sub {
  font-size: 11px;
  color: var(--text-4);
}

.photo-previews {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.photo-thumb {
  width: 68px;
  height: 68px;
  border-radius: var(--r-sm);
  object-fit: cover;
  border: 2px solid var(--border);
}

/* â”€â”€ DIVIDER â”€â”€ */
.form-divider {
  height: 1px;
  background: var(--divider);
  margin: 16px 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIZARD BOTTOM NAVIGATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wizard-footer {
  position: fixed;
  bottom: 60px;
  left: 0; right: 0;
  padding: 10px 18px calc(10px + env(safe-area-inset-bottom));
  background: var(--surface);
  border-top: 1px solid var(--divider);
  display: none;
  gap: 10px;
  z-index: 1700;
  box-shadow: 0 -2px 8px rgba(27,58,107,0.06);
}
.wizard-footer.active { display: flex; }

.wf-back {
  padding: 13px 18px;
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: var(--r-sm);
  font-family: var(--font);
  font-size: 13.5px;
  font-weight: 600;
  color: var(--text-2);
  cursor: pointer;
  transition: all 0.15s;
  flex-shrink: 0;
}
.wf-back:hover { background: var(--surface3); }

.wf-next {
  flex: 1;
  padding: 13px;
  background: var(--navy);
  border: none;
  border-radius: var(--r-sm);
  font-family: var(--font);
  font-size: 13.5px;
  font-weight: 700;
  color: var(--white);
  cursor: pointer;
  transition: all 0.15s;
  box-shadow: 0 2px 10px rgba(27,58,107,0.25);
  letter-spacing: 0.1px;
}
.wf-next:hover { background: var(--navy-d); }
.wf-next:active { transform: scale(0.99); }
.wf-next.submit {
  background: var(--green);
  box-shadow: 0 2px 10px rgba(26,122,74,0.25);
}
.wf-next.loading {
  opacity: 0.7;
  pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FULL-SCREEN VIEWS (LIST / RANK)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.full-view {
  position: fixed;
  inset: 0;
  top: 92px;
  bottom: 60px;
  background: var(--bg);
  z-index: 800;
  display: none;
  flex-direction: column;
  overflow: hidden;
}
.full-view.open { display: flex; }

.fv-header {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 12px 16px 10px;
  flex-shrink: 0;
}

.fv-title-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.fv-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
}

.fv-badge {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  background: var(--navy);
  color: var(--white);
  padding: 3px 10px;
  border-radius: 100px;
}

.filter-chips {
  display: flex;
  gap: 6px;
  overflow-x: auto;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}
.filter-chips::-webkit-scrollbar { display: none; }

.filter-chip {
  padding: 5px 13px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 100px;
  font-family: var(--font);
  font-size: 11.5px;
  font-weight: 600;
  color: var(--text-3);
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
  transition: all 0.13s;
}
.filter-chip.active {
  background: var(--navy);
  border-color: var(--navy);
  color: var(--white);
}

.fv-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px 14px 16px;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.fv-body::-webkit-scrollbar { display: none; }

/* â”€â”€ REPORT CARD â”€â”€ */
.report-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.13s;
  box-shadow: var(--sh-xs);
}
.report-card:active { transform: scale(0.99); box-shadow: none; }

.rc-severity-bar {
  height: 3px;
  width: 100%;
}

.rc-body {
  padding: 11px 13px 10px;
}

.rc-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 5px;
}

.rc-type-label {
  font-size: 13px;
  font-weight: 700;
  color: var(--text);
}

.rc-sev-badge {
  font-size: 10px;
  font-weight: 700;
  padding: 2px 9px;
  border-radius: 100px;
  white-space: nowrap;
  flex-shrink: 0;
}

.rc-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 6px;
}

.rc-tag {
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 3px;
  background: var(--surface2);
  border: 1px solid var(--border);
  color: var(--text-3);
  font-weight: 500;
}

.rc-desc {
  font-size: 12px;
  color: var(--text-2);
  line-height: 1.5;
  margin-bottom: 8px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.rc-footer {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 10.5px;
  color: var(--text-4);
}

.rc-vote-btn {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 100px;
  font-family: var(--font);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-3);
  cursor: pointer;
  transition: all 0.13s;
}
.rc-vote-btn.voted {
  background: var(--navy-xl);
  border-color: var(--navy-l);
  color: var(--navy);
}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 56px 24px;
  color: var(--text-4);
  text-align: center;
}
.empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.35; }
.empty-text { font-size: 13px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE / GAMIFICATION PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-card {
  background: var(--navy);
  border-radius: var(--r);
  padding: 18px;
  color: var(--white);
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
}
.profile-card::before {
  content: '';
  position: absolute;
  right: -24px; top: -24px;
  width: 120px; height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.04);
}

.pc-name {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 2px;
}
.pc-level {
  font-size: 11px;
  color: rgba(255,255,255,0.65);
  margin-bottom: 16px;
}
.pc-stats {
  display: flex;
  gap: 20px;
}
.pcs-num {
  font-family: var(--mono);
  font-size: 22px;
  font-weight: 700;
  color: #fbbf24;
}
.pcs-label {
  font-size: 10px;
  color: rgba(255,255,255,0.55);
  margin-top: 1px;
}
.pc-xp-bar {
  height: 4px;
  background: rgba(255,255,255,0.15);
  border-radius: 2px;
  margin: 14px 0 5px;
  overflow: hidden;
}
.pc-xp-fill {
  height: 100%;
  background: #fbbf24;
  border-radius: 2px;
  transition: width 0.6s ease;
}
.pc-xp-label {
  font-size: 10px;
  color: rgba(255,255,255,0.5);
}

.badge-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 14px;
}

.badge-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  padding: 11px 4px;
  text-align: center;
}
.badge-card.earned {
  background: var(--navy-xl);
  border-color: var(--navy-l);
}
.badge-card.locked { opacity: 0.35; }
.badge-card-icon { font-size: 26px; display: block; margin-bottom: 4px; }
.badge-card-name {
  font-size: 9.5px;
  font-weight: 600;
  color: var(--text-3);
  line-height: 1.2;
}
.badge-card.earned .badge-card-name { color: var(--navy); }

.pts-guide {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  overflow: hidden;
}
.pts-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 13px;
  border-bottom: 1px solid var(--divider);
  font-size: 12.5px;
}
.pts-row:last-child { border-bottom: none; }
.pts-val {
  font-family: var(--mono);
  font-weight: 700;
  color: var(--navy);
  font-size: 12px;
}

/* â”€â”€ LEADERBOARD â”€â”€ */
.lb-card {
  display: flex;
  align-items: center;
  gap: 11px;
  padding: 11px 13px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  margin-bottom: 6px;
  box-shadow: var(--sh-xs);
}
.lb-rank {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 700;
  color: var(--text-3);
  width: 28px;
  text-align: center;
  flex-shrink: 0;
}
.lb-avatar {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 13px;
  color: var(--white);
  flex-shrink: 0;
}
.lb-info { flex: 1; min-width: 0; }
.lb-name {
  font-size: 13px;
  font-weight: 700;
  color: var(--text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.lb-sub { font-size: 10.5px; color: var(--text-4); }
.lb-pts {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 700;
  color: var(--navy);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP POPUP CUSTOM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.map-popup {
  padding: 13px 14px;
  min-width: 220px;
  max-width: 270px;
}
.mp-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}
.mp-sev-bar {
  width: 4px;
  border-radius: 2px;
  align-self: stretch;
  flex-shrink: 0;
}
.mp-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--text);
}
.mp-badge {
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 100px;
  margin-bottom: 6px;
}
.mp-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  margin-bottom: 6px;
}
.mp-tag {
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 3px;
  background: var(--surface2);
  border: 1px solid var(--border);
  color: var(--text-3);
}
.mp-desc {
  font-size: 12px;
  color: var(--text-2);
  line-height: 1.5;
  margin-bottom: 6px;
}
.mp-meta {
  font-size: 10.5px;
  color: var(--text-4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST NOTIFICATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed;
  bottom: 76px;
  left: 50%;
  transform: translateX(-50%) translateY(16px);
  background: var(--navy);
  color: var(--white);
  padding: 10px 20px;
  border-radius: 100px;
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: 0 4px 20px rgba(27,58,107,0.25);
  max-width: 90vw;
}
.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}
.toast.error { background: var(--red); }
.toast.success { background: var(--green); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-heading {
  font-size: 11px;
  font-weight: 700;
  color: var(--text-3);
  text-transform: uppercase;
  letter-spacing: 0.7px;
  margin-bottom: 10px;
}

.required-note {
  font-size: 11px;
  color: var(--text-4);
  margin-top: 6px;
}
.required-note span { color: var(--red); }

/* cluster group styling override */
.marker-cluster {
  background: rgba(27,58,107,0.15) !important;
  border: 2px solid var(--navy) !important;
}
.marker-cluster div {
  background: var(--navy) !important;
  color: white !important;
  font-family: var(--mono) !important;
  font-weight: 700 !important;
}

@keyframes slide-up {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: none; }
}
.animate-in { animation: slide-up 0.22s ease both; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="header">
  <div class="header-logo">
    <div class="header-emblem">
      <!-- Road warning triangle SVG -->
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" fill="none" stroke="#1b3a6b" stroke-width="2" stroke-linejoin="round"/>
        <line x1="12" y1="9" x2="12" y2="13" stroke="#1b3a6b" stroke-width="2" stroke-linecap="round"/>
        <circle cx="12" cy="17" r="1" fill="#1b3a6b"/>
      </svg>
    </div>
    <div class="header-wordmark">
      <div class="header-title">à¸£à¸°à¸šà¸šà¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸—à¸²à¸‡à¸–à¸™à¸™</div>
      <div class="header-sub">SafeRoad TH â€” Road Hazard Reporting System</div>
    </div>
  </div>
  <div class="header-counters">
    <div class="hcnt">
      <div class="hcnt-dot" style="background:#c0392b"></div>
      <span class="hcnt-n" id="h-accident">0</span>
      <span class="hcnt-label">à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸</span>
    </div>
    <div class="hcnt">
      <div class="hcnt-dot" style="background:#e67e22"></div>
      <span class="hcnt-n" id="h-frequent">0</span>
      <span class="hcnt-label">à¹€à¸à¸´à¸”à¸šà¹ˆà¸­à¸¢</span>
    </div>
    <div class="hcnt">
      <div class="hcnt-dot" style="background:#27ae60"></div>
      <span class="hcnt-n" id="h-near">0</span>
      <span class="hcnt-label">à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”</span>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STATUS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="status-bar">
  <div class="sb-live">
    <div class="sb-live-dot"></div>
    à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸”
  </div>
  <div class="sb-separator"></div>
  <div class="sb-mode-btns">
    <button class="sb-mode-btn active" id="mb-pin"     onclick="setMapMode('pin')">à¹à¸ªà¸”à¸‡à¸ˆà¸¸à¸”</button>
    <button class="sb-mode-btn"        id="mb-heat"    onclick="setMapMode('heat')">à¸„à¸§à¸²à¸¡à¸«à¸™à¸²à¹à¸™à¹ˆà¸™</button>
    <button class="sb-mode-btn"        id="mb-cluster" onclick="setMapMode('cluster')">à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡</button>
  </div>
  <div class="sb-right">
    <div class="sb-user-btn" onclick="openPanel('profile')">
      <div class="sb-user-avatar" id="hdr-avatar">?</div>
      <span class="sb-user-pts" id="hdr-pts">0 à¸„à¸°à¹à¸™à¸™</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="map"></div>

<!-- Map FABs -->
<div class="map-fab-group">
  <button class="map-fab" onclick="doGPS()" title="à¹„à¸›à¸¢à¸±à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
      <line x1="12" y1="2" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="22"/>
      <line x1="2" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="22" y2="12"/>
    </svg>
  </button>
  <button class="map-fab map-fab-report" onclick="openReportPanel()" title="à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
  </button>
</div>

<!-- Map Legend -->
<div class="map-legend">
  <div class="legend-title">à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œ</div>
  <div class="legend-row"><div class="legend-dot" style="background:#c0392b"></div>à¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¹à¸¥à¹‰à¸§</div>
  <div class="legend-row"><div class="legend-dot" style="background:#e67e22"></div>à¸ˆà¸¸à¸”à¹€à¸à¸´à¸”à¸šà¹ˆà¸­à¸¢ / à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ªà¸¹à¸‡</div>
  <div class="legend-row"><div class="legend-dot" style="background:#27ae60"></div>à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸</div>
  <div class="legend-row"><div class="legend-dot" style="background:#2563eb"></div>à¸ªà¸±à¸‡à¹€à¸à¸•à¹€à¸«à¹‡à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="bottom-nav">
  <button class="nav-item active" id="ni-map" onclick="showView('map', this)">
    <div class="nav-icon">ğŸ—ºï¸</div>
    à¹à¸œà¸™à¸—à¸µà¹ˆ
  </button>
  <button class="nav-item" id="ni-list" onclick="showView('list', this)">
    <div class="nav-icon">ğŸ“‹</div>
    à¸£à¸²à¸¢à¸‡à¸²à¸™
  </button>
  <button class="nav-center-btn" onclick="openReportPanel()">
    <div class="nav-center-icon">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </div>
    à¸£à¸²à¸¢à¸‡à¸²à¸™
  </button>
  <button class="nav-item" id="ni-rank" onclick="showView('rank', this)">
    <div class="nav-icon">ğŸ†</div>
    à¸­à¸±à¸™à¸”à¸±à¸š
  </button>
  <button class="nav-item" id="ni-profile" onclick="openPanel('profile')">
    <div class="nav-icon">ğŸ‘¤</div>
    à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œ
  </button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FULL VIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- LIST VIEW -->
<div class="full-view" id="fv-list">
  <div class="fv-header">
    <div class="fv-title-row">
      <span class="fv-title">à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</span>
      <span class="fv-badge" id="list-count">0 à¸£à¸²à¸¢à¸à¸²à¸£</span>
    </div>
    <div class="filter-chips">
      <button class="filter-chip active" onclick="filterList('all',this)">à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
      <button class="filter-chip" onclick="filterList('accident',this)">à¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸</button>
      <button class="filter-chip" onclick="filterList('frequent',this)">à¹€à¸à¸´à¸”à¸šà¹ˆà¸­à¸¢</button>
      <button class="filter-chip" onclick="filterList('near',this)">à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸</button>
      <button class="filter-chip" onclick="filterList('observe',this)">à¸ªà¸±à¸‡à¹€à¸à¸•à¹€à¸«à¹‡à¸™</button>
    </div>
  </div>
  <div class="fv-body" id="list-body"></div>
</div>

<!-- RANK VIEW -->
<div class="full-view" id="fv-rank">
  <div class="fv-header">
    <div class="fv-title-row">
      <span class="fv-title">à¸­à¸±à¸™à¸”à¸±à¸šà¸œà¸¹à¹‰à¸¡à¸µà¸ªà¹ˆà¸§à¸™à¸£à¹ˆà¸§à¸¡</span>
    </div>
  </div>
  <div class="fv-body">
    <div style="background:var(--navy);border-radius:var(--r);padding:18px;margin-bottom:16px;color:var(--white);">
      <div style="font-size:10px;color:rgba(255,255,255,0.55);margin-bottom:4px;font-weight:600;text-transform:uppercase;letter-spacing:0.6px">à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹ƒà¸™à¸£à¸°à¸šà¸š</div>
      <div style="font-size:32px;font-weight:700;font-family:var(--mono);color:#fbbf24" id="rank-total">0</div>
      <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-top:4px">à¸ˆà¸¸à¸”à¸—à¸±à¹ˆà¸§à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ</div>
    </div>
    <div class="section-heading">à¸¥à¸³à¸”à¸±à¸šà¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™</div>
    <div id="lb-body"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="overlay" onclick="closeAllPanels()"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PANEL: REPORT WIZARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="panel-report">
  <div class="panel-handle-wrap"><div class="panel-handle"></div></div>

  <div class="panel-header">
    <div class="panel-header-left">
      <div class="panel-header-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1b3a6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/><circle cx="12" cy="17" r="1" fill="#1b3a6b" stroke="none"/>
        </svg>
      </div>
      <div>
        <div class="panel-title">à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸—à¸²à¸‡à¸–à¸™à¸™</div>
        <div class="panel-subtitle">à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸–à¹‰à¸§à¸™à¹€à¸à¸·à¹ˆà¸­à¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</div>
      </div>
    </div>
    <button class="panel-close" onclick="closeAllPanels()">âœ•</button>
  </div>

  <!-- STEPPER -->
  <div class="wizard-stepper">
    <div class="step-track">
      <div class="step-node active" id="sn-1">1</div>
      <div class="step-connector" id="sc-1"></div>
      <div class="step-node" id="sn-2">2</div>
      <div class="step-connector" id="sc-2"></div>
      <div class="step-node" id="sn-3">3</div>
      <div class="step-connector" id="sc-3"></div>
      <div class="step-node" id="sn-4">4</div>
      <div class="step-connector" id="sc-4"></div>
      <div class="step-node" id="sn-5">5</div>
    </div>
    <div class="step-info">
      <span class="step-label-current" id="step-label">à¸›à¸£à¸°à¹€à¸ à¸—à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸­à¸‡à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ</span>
      <span class="step-counter" id="step-counter">1 / 5</span>
    </div>
  </div>

  <div class="panel-body">

    <!-- â–‘â–‘â–‘â–‘ STEP 1: à¸›à¸£à¸°à¹€à¸ à¸—à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ â–‘â–‘â–‘â–‘ -->
    <div class="step-page active" id="sp-1">
      <div class="field-section">
        <label class="field-label">à¸¥à¸±à¸à¸©à¸“à¸°à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ<span class="req">*</span></label>
        <div class="field-desc">à¹€à¸¥à¸·à¸­à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸à¸šà¹€à¸«à¹‡à¸™à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”</div>
      </div>

      <div class="event-options">
        <button class="event-opt" data-sev="accident" onclick="selectEventType(this)">
          <div class="event-opt-icon">ğŸš¨</div>
          <div class="event-opt-text">
            <div class="event-opt-title">à¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¹à¸¥à¹‰à¸§</div>
            <div class="event-opt-desc">à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢ à¸à¸²à¸£à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸š à¸«à¸£à¸·à¸­à¹€à¸ªà¸µà¸¢à¸Šà¸µà¸§à¸´à¸•à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™</div>
          </div>
          <div class="event-opt-badge" style="border-color:#c0392b"></div>
        </button>
        <button class="event-opt" data-sev="frequent" onclick="selectEventType(this)">
          <div class="event-opt-icon">âš ï¸</div>
          <div class="event-opt-text">
            <div class="event-opt-title">à¸ˆà¸¸à¸”à¸™à¸µà¹‰à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸à¸šà¹ˆà¸­à¸¢à¸„à¸£à¸±à¹‰à¸‡</div>
            <div class="event-opt-desc">à¸—à¸£à¸²à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¸«à¸£à¸·à¸­à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¸‹à¹‰à¸³à¹ƒà¸™à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸™à¸µà¹‰</div>
          </div>
          <div class="event-opt-badge" style="border-color:#e67e22"></div>
        </button>
        <button class="event-opt" data-sev="near" onclick="selectEventType(this)">
          <div class="event-opt-icon">âš¡</div>
          <div class="event-opt-text">
            <div class="event-opt-title">à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸</div>
            <div class="event-opt-desc">à¹€à¸‰à¸µà¸¢à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸ à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢ à¹à¸•à¹ˆà¹€à¸›à¹‡à¸™à¸ªà¸±à¸à¸à¸²à¸“à¹€à¸•à¸·à¸­à¸™</div>
          </div>
          <div class="event-opt-badge" style="border-color:#27ae60"></div>
        </button>
        <button class="event-opt" data-sev="observe" onclick="selectEventType(this)">
          <div class="event-opt-icon">ğŸ‘ï¸</div>
          <div class="event-opt-text">
            <div class="event-opt-title">à¸ªà¸±à¸‡à¹€à¸à¸•à¹€à¸«à¹‡à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡</div>
            <div class="event-opt-desc">à¸à¸šà¸§à¹ˆà¸²à¸ªà¸ à¸²à¸à¸–à¸™à¸™à¸«à¸£à¸·à¸­à¸ªà¸´à¹ˆà¸‡à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡ à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸</div>
          </div>
          <div class="event-opt-badge" style="border-color:#2563eb"></div>
        </button>
      </div>

      <!-- à¸„à¸§à¸²à¸¡à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸­à¸‡à¸à¸²à¸£à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸š (à¹à¸ªà¸”à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸ accident) -->
      <div class="injury-section" id="injury-section">
        <label class="field-label">à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸­à¸‡à¸à¸²à¸£à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸š<span class="req">*</span></label>
        <div style="margin-top: 8px;">
          <div class="opts-2">
            <button class="opt-card" data-f="injury" data-v="fatal" onclick="selSingle(this,'injury')">
              <span class="opt-card-icon">ğŸ’€</span>à¸¡à¸µà¸œà¸¹à¹‰à¹€à¸ªà¸µà¸¢à¸Šà¸µà¸§à¸´à¸•
            </button>
            <button class="opt-card" data-f="injury" data-v="serious" onclick="selSingle(this,'injury')">
              <span class="opt-card-icon">ğŸ¥</span>à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸šà¸ªà¸²à¸«à¸±à¸ª<br><small style="font-size:10px;color:var(--text-4)">à¸•à¹‰à¸­à¸‡à¸™à¸­à¸™ à¸£à¸.</small>
            </button>
            <button class="opt-card" data-f="injury" data-v="minor" onclick="selSingle(this,'injury')">
              <span class="opt-card-icon">ğŸ©¹</span>à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸šà¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢
            </button>
            <button class="opt-card" data-f="injury" data-v="property" onclick="selSingle(this,'injury')">
              <span class="opt-card-icon">ğŸ’¢</span>à¸—à¸£à¸±à¸à¸¢à¹Œà¸ªà¸´à¸™à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢<br><small style="font-size:10px;color:var(--text-4)">à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¹à¹‰à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸š</small>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘ STEP 2: à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹à¸¥à¸°à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ â–‘â–‘â–‘â–‘ -->
    <div class="step-page" id="sp-2">
      <div class="field-section">
        <label class="field-label">à¸à¸´à¸à¸±à¸”à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸<span class="req">*</span></label>
        <div class="field-desc">à¹ƒà¸Šà¹‰ GPS à¸«à¸£à¸·à¸­à¹à¸•à¸°à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆà¹€à¸à¸·à¹ˆà¸­à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡</div>
      </div>

      <div class="gps-row">
        <button class="gps-btn" id="gps-btn" onclick="getGPS()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
            <line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/>
            <line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/>
          </svg>
          à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ GPS
        </button>
        <div class="coord-display" id="coord-display">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0">
            <circle cx="12" cy="10" r="3"/><path d="M12 2a8 8 0 00-8 8c0 5 8 12 8 12s8-7 8-12a8 8 0 00-8-8z"/>
          </svg>
          <span class="coord-text" id="coord-text">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡</span>
        </div>
      </div>
      <div class="map-tap-hint">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
        </svg>
        à¸«à¸£à¸·à¸­à¹à¸•à¸°à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆà¸”à¹‰à¸²à¸™à¸«à¸¥à¸±à¸‡à¹€à¸à¸·à¹ˆà¸­à¸›à¸±à¸à¸«à¸¡à¸¸à¸”à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸¥à¸±à¸à¸©à¸“à¸°à¸‚à¸­à¸‡à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ<span class="req">*</span></label>
        <div class="field-desc">à¹€à¸¥à¸·à¸­à¸à¸¥à¸±à¸à¸©à¸“à¸°à¸—à¸²à¸‡à¸à¸²à¸¢à¸ à¸²à¸à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸ˆà¸¸à¸”à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸</div>
      </div>
      <div class="opts-3">
        <button class="opt-card" data-f="place" data-v="intersection" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸš¦</span>à¸ªà¸µà¹ˆà¹à¸¢à¸</button>
        <button class="opt-card" data-f="place" data-v="tjunction" onclick="selSingle(this,'place')"><span class="opt-card-icon">â†—ï¸</span>à¹à¸¢à¸ T</button>
        <button class="opt-card" data-f="place" data-v="roundabout" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸ”„</span>à¸§à¸‡à¹€à¸§à¸µà¸¢à¸™</button>
        <button class="opt-card" data-f="place" data-v="curve" onclick="selSingle(this,'place')"><span class="opt-card-icon">â†©ï¸</span>à¹‚à¸„à¹‰à¸‡à¸–à¸™à¸™</button>
        <button class="opt-card" data-f="place" data-v="straight" onclick="selSingle(this,'place')"><span class="opt-card-icon">â¡ï¸</span>à¸—à¸²à¸‡à¸•à¸£à¸‡</button>
        <button class="opt-card" data-f="place" data-v="slope" onclick="selSingle(this,'place')"><span class="opt-card-icon">â›°ï¸</span>à¸—à¸²à¸‡à¸¥à¸²à¸”à¸Šà¸±à¸™</button>
        <button class="opt-card" data-f="place" data-v="crosswalk" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸš¶</span>à¸—à¸²à¸‡à¸‚à¹‰à¸²à¸¡à¸„à¸™à¹€à¸”à¸´à¸™</button>
        <button class="opt-card" data-f="place" data-v="school_zone" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸ«</span>à¸«à¸™à¹‰à¸²à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™</button>
        <button class="opt-card" data-f="place" data-v="bridge" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸŒ‰</span>à¸ªà¸°à¸à¸²à¸™</button>
        <button class="opt-card" data-f="place" data-v="highway" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸ›£ï¸</span>à¸—à¸²à¸‡à¸«à¸¥à¸§à¸‡</button>
        <button class="opt-card" data-f="place" data-v="alley" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸ˜ï¸</span>à¸‹à¸­à¸¢/à¸Šà¸¸à¸¡à¸Šà¸™</button>
        <button class="opt-card" data-f="place" data-v="campus" onclick="selSingle(this,'place')"><span class="opt-card-icon">ğŸ“</span>à¸ à¸²à¸¢à¹ƒà¸™à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸¢à¸²à¸™à¸à¸²à¸«à¸™à¸°à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡ <span style="font-weight:400;color:var(--text-4)">(à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸›à¸£à¸°à¹€à¸ à¸—)</span></label>
      </div>
      <div class="opts-4" id="veh-grid">
        <button class="opt-card" data-f="vehicles" data-v="motorcycle" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸï¸</span>à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ</button>
        <button class="opt-card" data-f="vehicles" data-v="car" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸš—</span>à¸£à¸–à¸¢à¸™à¸•à¹Œ</button>
        <button class="opt-card" data-f="vehicles" data-v="truck" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸš›</span>à¸£à¸–à¸šà¸£à¸£à¸—à¸¸à¸</button>
        <button class="opt-card" data-f="vehicles" data-v="bus" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸšŒ</span>à¸£à¸–à¹‚à¸”à¸¢à¸ªà¸²à¸£</button>
        <button class="opt-card" data-f="vehicles" data-v="bicycle" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸš²</span>à¸ˆà¸±à¸à¸£à¸¢à¸²à¸™</button>
        <button class="opt-card" data-f="vehicles" data-v="tricycle" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸ›º</span>à¸ªà¸²à¸¡à¸¥à¹‰à¸­</button>
        <button class="opt-card" data-f="vehicles" data-v="pedestrian" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">ğŸš¶</span>à¸„à¸™à¹€à¸”à¸´à¸™à¹€à¸—à¹‰à¸²</button>
        <button class="opt-card" data-f="vehicles" data-v="unknown" onclick="selMulti(this,'vehicles')"><span class="opt-card-icon">â”</span>à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š</button>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘ STEP 3: à¸¥à¸±à¸à¸©à¸“à¸°à¹€à¸«à¸•à¸¸ & à¸ªà¸²à¹€à¸«à¸•à¸¸ â–‘â–‘â–‘â–‘ -->
    <div class="step-page" id="sp-3">
      <div class="field-section">
        <label class="field-label">à¸£à¸¹à¸›à¹à¸šà¸šà¸à¸²à¸£à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸<span class="req">*</span></label>
        <div class="field-desc">à¹€à¸¥à¸·à¸­à¸à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™ à¸«à¸£à¸·à¸­à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸”</div>
      </div>
      <div class="opts-2">
        <button class="opt-card" data-f="incident" data-v="head_on" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸ’¥</span>à¸£à¸–à¸Šà¸™à¸›à¸£à¸°à¸ªà¸²à¸™à¸‡à¸²</button>
        <button class="opt-card" data-f="incident" data-v="rear_end" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸš—ğŸ’¨</span>à¸£à¸–à¸Šà¸™à¸—à¹‰à¸²à¸¢</button>
        <button class="opt-card" data-f="incident" data-v="side_swipe" onclick="selSingle(this,'incident')"><span class="opt-card-icon">â†”ï¸</span>à¸£à¸–à¸Šà¸™à¸”à¹‰à¸²à¸™à¸‚à¹‰à¸²à¸‡</button>
        <button class="opt-card" data-f="incident" data-v="hit_ped" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸš¶â€â™‚ï¸</span>à¸£à¸–à¸Šà¸™à¸„à¸™à¹€à¸”à¸´à¸™à¹€à¸—à¹‰à¸²</button>
        <button class="opt-card" data-f="incident" data-v="rollover" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸŒ€</span>à¸£à¸–à¸à¸¥à¸´à¸à¸„à¸§à¹ˆà¸³</button>
        <button class="opt-card" data-f="incident" data-v="run_off" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸ›£ï¸</span>à¸£à¸–à¸•à¸à¸–à¸™à¸™/à¸•à¸à¸„à¸¥à¸­à¸‡</button>
        <button class="opt-card" data-f="incident" data-v="fall_slip" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸ’§</span>à¸¥à¹‰à¸¡ / à¸¥à¸·à¹ˆà¸™à¹„à¸–à¸¥</button>
        <button class="opt-card" data-f="incident" data-v="hit_object" onclick="selSingle(this,'incident')"><span class="opt-card-icon">ğŸª¨</span>à¸Šà¸™à¸ªà¸´à¹ˆà¸‡à¸à¸µà¸”à¸‚à¸§à¸²à¸‡</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸ªà¸²à¹€à¸«à¸•à¸¸à¸—à¸µà¹ˆà¸„à¸²à¸”à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™ <span style="font-weight:400;color:var(--text-4)">(à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸‚à¹‰à¸­)</span></label>
        <div class="field-desc">à¸£à¸°à¸šà¸¸à¸›à¸±à¸ˆà¸ˆà¸±à¸¢à¸—à¸µà¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸§à¹ˆà¸²à¸¡à¸µà¸ªà¹ˆà¸§à¸™à¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡</div>
      </div>
      <div class="opts-3" id="cause-grid">
        <button class="opt-card" data-f="causes" data-v="speeding" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸï¸</span>à¸‚à¸±à¸šà¹€à¸£à¹‡à¸§à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”</button>
        <button class="opt-card" data-f="causes" data-v="drunk" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸº</span>à¸ªà¸‡à¸ªà¸±à¸¢à¹€à¸¡à¸²à¸ªà¸¸à¸£à¸²</button>
        <button class="opt-card" data-f="causes" data-v="sleepy" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸ˜´</span>à¸‡à¹ˆà¸§à¸‡/à¹€à¸«à¸¡à¹ˆà¸­à¸¥à¸­à¸¢</button>
        <button class="opt-card" data-f="causes" data-v="distracted" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸ“±</span>à¹ƒà¸Šà¹‰à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸‚à¸“à¸°à¸‚à¸±à¸š</button>
        <button class="opt-card" data-f="causes" data-v="red_light" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸš¦</span>à¸à¹ˆà¸²à¸ªà¸±à¸à¸à¸²à¸“à¹„à¸Ÿà¹à¸”à¸‡</button>
        <button class="opt-card" data-f="causes" data-v="no_yield" onclick="selMulti(this,'causes')"><span class="opt-card-icon">â›”</span>à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸”à¹ƒà¸«à¹‰à¸—à¸²à¸‡</button>
        <button class="opt-card" data-f="causes" data-v="low_vis" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸŒ«ï¸</span>à¸—à¸±à¸¨à¸™à¸§à¸´à¸ªà¸±à¸¢à¸•à¹ˆà¸³</button>
        <button class="opt-card" data-f="causes" data-v="slippery" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸŒ§ï¸</span>à¸–à¸™à¸™à¸¥à¸·à¹ˆà¸™/à¸™à¹‰à¸³à¸—à¹ˆà¸§à¸¡</button>
        <button class="opt-card" data-f="causes" data-v="no_light" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸ”¦</span>à¹„à¸Ÿà¸ªà¹ˆà¸­à¸‡à¸ªà¸§à¹ˆà¸²à¸‡à¹„à¸¡à¹ˆà¹€à¸à¸µà¸¢à¸‡à¸à¸­</button>
        <button class="opt-card" data-f="causes" data-v="road_defect" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸ•³ï¸</span>à¸–à¸™à¸™à¸Šà¸³à¸£à¸¸à¸”/à¸šà¹ˆà¸­</button>
        <button class="opt-card" data-f="causes" data-v="no_sign" onclick="selMulti(this,'causes')"><span class="opt-card-icon">ğŸª§</span>à¸›à¹‰à¸²à¸¢à¹€à¸•à¸·à¸­à¸™à¹„à¸¡à¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™</button>
        <button class="opt-card" data-f="causes" data-v="unknown" onclick="selMulti(this,'causes')"><span class="opt-card-icon">â”</span>à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸ªà¸²à¹€à¸«à¸•à¸¸</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸à¸¥à¸¸à¹ˆà¸¡à¸œà¸¹à¹‰à¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡ <span style="font-weight:400;color:var(--text-4)">(à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸à¸¥à¸¸à¹ˆà¸¡)</span></label>
        <div class="field-desc">à¸£à¸°à¸šà¸¸à¸à¸¥à¸¸à¹ˆà¸¡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸–à¸™à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸œà¸¥à¸à¸£à¸°à¸—à¸š</div>
      </div>
      <div class="opts-4" id="group-grid">
        <button class="opt-card" data-f="groups" data-v="child" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ‘¦</span>à¹€à¸”à¹‡à¸<br><small style="font-size:9.5px;color:var(--text-4)">à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² 15 à¸›à¸µ</small></button>
        <button class="opt-card" data-f="groups" data-v="elderly" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ‘´</span>à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸<br><small style="font-size:9.5px;color:var(--text-4)">60 à¸›à¸µà¸‚à¸¶à¹‰à¸™à¹„à¸›</small></button>
        <button class="opt-card" data-f="groups" data-v="student" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ“</span>à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™/<br>à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²</button>
        <button class="opt-card" data-f="groups" data-v="disabled" onclick="selMulti(this,'groups')"><span class="opt-card-icon">â™¿</span>à¸œà¸¹à¹‰à¸à¸´à¸à¸²à¸£/<br>à¸§à¸µà¸¥à¹à¸Šà¸£à¹Œ</button>
        <button class="opt-card" data-f="groups" data-v="worker" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ‘·</span>à¸„à¸™à¸‡à¸²à¸™/<br>à¹à¸£à¸‡à¸‡à¸²à¸™</button>
        <button class="opt-card" data-f="groups" data-v="general" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ‘¥</span>à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™<br>à¸—à¸±à¹ˆà¸§à¹„à¸›</button>
        <button class="opt-card" data-f="groups" data-v="tourist" onclick="selMulti(this,'groups')"><span class="opt-card-icon">ğŸ§³</span>à¸™à¸±à¸à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§</button>
        <button class="opt-card" data-f="groups" data-v="unknown" onclick="selMulti(this,'groups')"><span class="opt-card-icon">â”</span>à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š</button>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘ STEP 4: à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡ â–‘â–‘â–‘â–‘ -->
    <div class="step-page" id="sp-4">
      <div class="field-section">
        <label class="field-label">à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸<span class="req">*</span></label>
      </div>
      <div class="pill-row">
        <button class="pill-opt" data-f="time_slot" data-v="dawn" onclick="selSingle(this,'time_slot')">ğŸŒ… à¸£à¸¸à¹ˆà¸‡à¹€à¸Šà¹‰à¸² (05:00â€“09:00)</button>
        <button class="pill-opt" data-f="time_slot" data-v="morning" onclick="selSingle(this,'time_slot')">â˜€ï¸ à¸ªà¸²à¸¢ (09:00â€“12:00)</button>
        <button class="pill-opt" data-f="time_slot" data-v="afternoon" onclick="selSingle(this,'time_slot')">ğŸŒ¤ï¸ à¸šà¹ˆà¸²à¸¢ (12:00â€“16:00)</button>
        <button class="pill-opt" data-f="time_slot" data-v="evening" onclick="selSingle(this,'time_slot')">ğŸŒ† à¹€à¸¢à¹‡à¸™ (16:00â€“20:00)</button>
        <button class="pill-opt" data-f="time_slot" data-v="night" onclick="selSingle(this,'time_slot')">ğŸŒ™ à¸à¸¥à¸²à¸‡à¸„à¸·à¸™ (20:00â€“01:00)</button>
        <button class="pill-opt" data-f="time_slot" data-v="late_night" onclick="selSingle(this,'time_slot')">ğŸŒš à¸”à¸¶à¸ (01:00â€“05:00)</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸ªà¸ à¸²à¸à¸­à¸²à¸à¸²à¸¨à¹à¸¥à¸°à¸—à¸±à¸¨à¸™à¸§à¸´à¸ªà¸±à¸¢<span class="req">*</span></label>
      </div>
      <div class="opts-4">
        <button class="opt-card" data-f="weather" data-v="clear" onclick="selSingle(this,'weather')"><span class="opt-card-icon">â˜€ï¸</span>à¹à¸”à¸”à¸ˆà¸±à¸”/à¸›à¸à¸•à¸´</button>
        <button class="opt-card" data-f="weather" data-v="overcast" onclick="selSingle(this,'weather')"><span class="opt-card-icon">â›…</span>à¸¡à¸µà¹€à¸¡à¸†/à¸„à¸£à¸¶à¹‰à¸¡</button>
        <button class="opt-card" data-f="weather" data-v="rain" onclick="selSingle(this,'weather')"><span class="opt-card-icon">ğŸŒ§ï¸</span>à¸à¸™à¸•à¸</button>
        <button class="opt-card" data-f="weather" data-v="fog" onclick="selSingle(this,'weather')"><span class="opt-card-icon">ğŸŒ«ï¸</span>à¸«à¸¡à¸­à¸à¸«à¸™à¸²</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸</label>
      </div>
      <div class="pill-row">
        <button class="pill-opt" data-f="day_type" data-v="weekday" onclick="selSingle(this,'day_type')">ğŸ“… à¸§à¸±à¸™à¸˜à¸£à¸£à¸¡à¸”à¸² (à¸ˆà¸±à¸™à¸—à¸£à¹Œâ€“à¸¨à¸¸à¸à¸£à¹Œ)</button>
        <button class="pill-opt" data-f="day_type" data-v="weekend" onclick="selSingle(this,'day_type')">ğŸ—“ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸” (à¹€à¸ªà¸²à¸£à¹Œâ€“à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ)</button>
        <button class="pill-opt" data-f="day_type" data-v="holiday" onclick="selSingle(this,'day_type')">ğŸ‰ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¸™à¸±à¸à¸‚à¸±à¸•à¸¤à¸à¸©à¹Œ</button>
      </div>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸‚à¹‰à¸­à¸šà¸à¸à¸£à¹ˆà¸­à¸‡à¸‚à¸­à¸‡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸·à¹‰à¸™à¸à¸²à¸™ <span style="font-weight:400;color:var(--text-4)">(à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸‚à¹‰à¸­)</span></label>
        <div class="field-desc">à¸£à¸°à¸šà¸¸à¸›à¸±à¸à¸«à¸²à¸—à¸²à¸‡à¸à¸²à¸¢à¸ à¸²à¸à¸—à¸µà¹ˆà¸à¸šà¹ƒà¸™à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ</div>
      </div>
      <div class="opts-3" id="infra-grid">
        <button class="opt-card" data-f="infra" data-v="no_signal" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸš¦</span>à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸±à¸à¸à¸²à¸“à¹„à¸Ÿà¸ˆà¸£à¸²à¸ˆà¸£</button>
        <button class="opt-card" data-f="infra" data-v="no_sign" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸª§</span>à¸‚à¸²à¸”à¸›à¹‰à¸²à¸¢à¹€à¸•à¸·à¸­à¸™/à¸›à¹‰à¸²à¸¢à¸šà¸­à¸à¸—à¸²à¸‡</button>
        <button class="opt-card" data-f="infra" data-v="no_barrier" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸš§</span>à¹„à¸¡à¹ˆà¸¡à¸µà¹à¸œà¸‡à¸à¸±à¹‰à¸™à¸«à¸£à¸·à¸­à¸£à¸²à¸§à¸à¸±à¸™à¸•à¸</button>
        <button class="opt-card" data-f="infra" data-v="no_sidewalk" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸš¶</span>à¸‚à¸²à¸”à¸—à¸²à¸‡à¹€à¸—à¹‰à¸²/à¸—à¸²à¸‡à¸ˆà¸±à¸à¸£à¸¢à¸²à¸™</button>
        <button class="opt-card" data-f="infra" data-v="narrow_road" onclick="selMulti(this,'infra')"><span class="opt-card-icon">â†”ï¸</span>à¸–à¸™à¸™à¹à¸„à¸šà¹€à¸à¸´à¸™à¹„à¸›</button>
        <button class="opt-card" data-f="infra" data-v="pothole" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸ•³ï¸</span>à¸šà¹ˆà¸­/à¸œà¸´à¸§à¸–à¸™à¸™à¸Šà¸³à¸£à¸¸à¸”</button>
        <button class="opt-card" data-f="infra" data-v="faded_marking" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸ“</span>à¹€à¸ªà¹‰à¸™à¸ˆà¸£à¸²à¸ˆà¸£à¸¥à¸š/à¸Šà¸³à¸£à¸¸à¸”</button>
        <button class="opt-card" data-f="infra" data-v="obstruction" onclick="selMulti(this,'infra')"><span class="opt-card-icon">ğŸª¨</span>à¸¡à¸µà¸ªà¸´à¹ˆà¸‡à¸à¸µà¸”à¸‚à¸§à¸²à¸‡</button>
        <button class="opt-card" data-f="infra" data-v="no_ramp" onclick="selMulti(this,'infra')"><span class="opt-card-icon">â™¿</span>à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¸²à¸‡à¸¥à¸²à¸”à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸à¸´à¸à¸²à¸£</button>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘ STEP 5: à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¹à¸¥à¸°à¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™ â–‘â–‘â–‘â–‘ -->
    <div class="step-page" id="sp-5">
      <div class="field-section">
        <label class="field-label">à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ <span style="font-weight:400;color:var(--text-4)">(à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)</span></label>
        <div class="field-desc">à¸­à¸˜à¸´à¸šà¸²à¸¢à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ à¹€à¸Šà¹ˆà¸™ à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸—à¸µà¹ˆà¹à¸¡à¹ˆà¸™à¸¢à¸³ à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¹€à¸«à¹‡à¸™ à¸«à¸£à¸·à¸­à¸‚à¹‰à¸­à¹€à¸ªà¸™à¸­à¹à¸™à¸°</div>
      </div>
      <textarea class="form-textarea" id="inp-desc" placeholder="à¹€à¸Šà¹ˆà¸™: à¸šà¹ˆà¸­à¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆà¸­à¸¢à¸¹à¹ˆà¸à¸¥à¸²à¸‡à¹€à¸¥à¸™à¸‹à¹‰à¸²à¸¢ à¸«à¹ˆà¸²à¸‡à¸ˆà¸²à¸à¸›à¹‰à¸²à¸¢à¸£à¸–à¹€à¸¡à¸¥à¹Œà¸›à¸£à¸°à¸¡à¸²à¸“ 50 à¹€à¸¡à¸•à¸£ à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸£à¸§à¸¢à¸à¸±à¹‰à¸™..."></textarea>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸ à¸²à¸à¸«à¸¥à¸±à¸à¸à¸²à¸™à¸›à¸£à¸°à¸à¸­à¸š <span style="font-weight:400;color:var(--text-4)">(à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)</span></label>
        <div class="field-desc">à¸ à¸²à¸à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸«à¸£à¸·à¸­à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢à¸ˆà¸°à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹„à¸”à¹‰à¸£à¸§à¸”à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™</div>
      </div>
      <label class="photo-upload-zone" id="photo-zone">
        <input type="file" id="photo-input" accept="image/*" multiple onchange="handlePhotoUpload(event)">
        <div class="photo-upload-icon">ğŸ“·</div>
        <div class="photo-upload-title">à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸«à¸£à¸·à¸­à¸–à¹ˆà¸²à¸¢à¸ à¸²à¸</div>
        <div class="photo-upload-sub">à¹„à¸Ÿà¸¥à¹Œ JPG, PNG â€” à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 3 à¸£à¸¹à¸›</div>
        <div class="photo-previews" id="photo-previews"></div>
      </label>

      <div class="form-divider"></div>

      <div class="field-section">
        <label class="field-label">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™ <span style="font-weight:400;color:var(--text-4)">(à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)</span></label>
      </div>
      <input class="form-input" id="inp-name" placeholder="à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ à¸«à¸£à¸·à¸­à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™" style="margin-bottom:8px">

      <div class="field-section" style="margin-top:10px">
        <label class="field-label">à¸ªà¸–à¸²à¸™à¸°à¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™</label>
      </div>
      <div class="opts-3">
        <button class="opt-card" data-f="reporter_role" data-v="student" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ“</span>à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™/<br>à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²</button>
        <button class="opt-card" data-f="reporter_role" data-v="staff" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ«</span>à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œ/<br>à¸šà¸¸à¸„à¸¥à¸²à¸à¸£</button>
        <button class="opt-card" data-f="reporter_role" data-v="public" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ‘¤</span>à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™<br>à¸—à¸±à¹ˆà¸§à¹„à¸›</button>
        <button class="opt-card" data-f="reporter_role" data-v="victim" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ©¹</span>à¸œà¸¹à¹‰à¸›à¸£à¸°à¸ªà¸šà¹€à¸«à¸•à¸¸<br>à¹‚à¸”à¸¢à¸•à¸£à¸‡</button>
        <button class="opt-card" data-f="reporter_role" data-v="witness" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ‘ï¸</span>à¸à¸¢à¸²à¸™<br>à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ</button>
        <button class="opt-card" data-f="reporter_role" data-v="officer" onclick="selSingle(this,'reporter_role')"><span class="opt-card-icon">ğŸ‘®</span>à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ</button>
      </div>

      <div style="margin-top:12px;padding:11px 13px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-sm);font-size:12px;color:var(--text-3);line-height:1.6;">
        à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸°à¸–à¸¹à¸à¸ªà¹ˆà¸‡à¹ƒà¸«à¹‰à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡à¹€à¸à¸·à¹ˆà¸­à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸—à¸²à¸‡à¸–à¸™à¸™ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§à¸ˆà¸°à¸–à¸¹à¸à¹€à¸à¹‡à¸šà¸£à¸±à¸à¸©à¸²à¹€à¸›à¹‡à¸™à¸„à¸§à¸²à¸¡à¸¥à¸±à¸š
      </div>

      <div id="submit-status" style="display:none;margin-top:10px;padding:11px 13px;border-radius:var(--r-sm);font-size:13px;font-weight:500;"></div>
    </div>

  </div><!-- /panel-body -->

  <!-- WIZARD FOOTER BUTTONS -->
  <div class="wizard-footer active" id="wizard-footer">
    <button class="wf-back" id="wf-back" style="display:none" onclick="wizardBack()">â† à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸š</button>
    <button class="wf-next" id="wf-next" onclick="wizardNext()">à¸–à¸±à¸”à¹„à¸› â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PANEL: PROFILE & GAMIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="panel-profile">
  <div class="panel-handle-wrap"><div class="panel-handle"></div></div>
  <div class="panel-header">
    <div class="panel-header-left">
      <div class="panel-header-icon">ğŸ‘¤</div>
      <div>
        <div class="panel-title">à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ</div>
        <div class="panel-subtitle">à¸•à¸´à¸”à¸•à¸²à¸¡à¸„à¸°à¹à¸™à¸™à¹à¸¥à¸°à¹€à¸«à¸£à¸µà¸¢à¸à¸£à¸²à¸‡à¸§à¸±à¸¥</div>
      </div>
    </div>
    <button class="panel-close" onclick="closeAllPanels()">âœ•</button>
  </div>
  <div class="panel-body">
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="pc-name" id="prof-name">à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</div>
      <div class="pc-level" id="prof-level">à¸£à¸°à¸”à¸±à¸š: à¸œà¸¹à¹‰à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</div>
      <div class="pc-stats">
        <div><div class="pcs-num" id="prof-pts">0</div><div class="pcs-label">à¸„à¸°à¹à¸™à¸™à¸ªà¸°à¸ªà¸¡</div></div>
        <div><div class="pcs-num" id="prof-reps">0</div><div class="pcs-label">à¸£à¸²à¸¢à¸‡à¸²à¸™</div></div>
        <div><div class="pcs-num" id="prof-votes-recv">0</div><div class="pcs-label">à¹‚à¸«à¸§à¸•à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š</div></div>
      </div>
      <div class="pc-xp-bar"><div class="pc-xp-fill" id="xp-fill" style="width:0%"></div></div>
      <div class="pc-xp-label" id="xp-label">0 / 100 XP à¸ªà¸¹à¹ˆà¸£à¸°à¸”à¸±à¸šà¸–à¸±à¸”à¹„à¸›</div>
    </div>

    <!-- Edit name -->
    <div style="margin-bottom:16px">
      <div class="field-section"><label class="field-label">à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</label></div>
      <div style="display:flex;gap:8px">
        <input class="form-input" id="edit-name" placeholder="à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ à¸«à¸£à¸·à¸­à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™">
        <button onclick="saveName()" style="padding:0 16px;background:var(--navy);color:var(--white);border:none;border-radius:var(--r-sm);font-family:var(--font);font-size:13px;font-weight:700;cursor:pointer;flex-shrink:0;white-space:nowrap;letter-spacing:0.1px">à¸šà¸±à¸™à¸—à¸¶à¸</button>
      </div>
    </div>

    <div class="form-divider"></div>

    <div class="section-heading">à¹€à¸«à¸£à¸µà¸¢à¸à¸£à¸²à¸‡à¸§à¸±à¸¥</div>
    <div class="badge-grid" id="badge-grid"></div>

    <div class="form-divider"></div>

    <div class="section-heading">à¹€à¸à¸“à¸‘à¹Œà¸à¸²à¸£à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸°à¹à¸™à¸™</div>
    <div class="pts-guide">
      <div class="pts-row"><span>à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ</span><span class="pts-val">+10 à¸„à¸°à¹à¸™à¸™</span></div>
      <div class="pts-row"><span>à¸£à¸²à¸¢à¸‡à¸²à¸™ "à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸" (Near-Miss)</span><span class="pts-val">+10 à¸„à¸°à¹à¸™à¸™à¹€à¸à¸´à¹ˆà¸¡</span></div>
      <div class="pts-row"><span>à¹à¸™à¸šà¸ à¸²à¸à¸«à¸¥à¸±à¸à¸à¸²à¸™</span><span class="pts-val">+5 à¸„à¸°à¹à¸™à¸™</span></div>
      <div class="pts-row"><span>à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸·à¹ˆà¸™à¸¢à¸·à¸™à¸¢à¸±à¸™à¸£à¸²à¸¢à¸‡à¸²à¸™</span><span class="pts-val">+5 à¸„à¸°à¹à¸™à¸™</span></div>
      <div class="pts-row"><span>à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¹à¸¥à¹‰à¸§</span><span class="pts-val">+20 à¸„à¸°à¹à¸™à¸™</span></div>
    </div>

    <div style="height:16px"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GAS_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GLOBAL STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const APP = {
  reports: [],
  user:    { name:'', pts:0 },
  form:    {},
  step:    1,
  lat:     null,
  lng:     null,
  photos:  [],
  filter:  'all',
  mapMode: 'pin',
  pinLayers:     [],
  heatLayer:     null,
  clusterGroup:  null,
  tempMarker:    null,
};

const TOTAL_STEPS = 5;

// â”€â”€ Lookup tables â”€â”€
const SEV_COLOR = {
  accident: '#c0392b',
  frequent: '#e67e22',
  near:     '#27ae60',
  observe:  '#2563eb',
};
const SEV_LABEL = {
  accident: 'à¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¹à¸¥à¹‰à¸§',
  frequent: 'à¹€à¸à¸´à¸”à¸šà¹ˆà¸­à¸¢/à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ªà¸¹à¸‡',
  near:     'à¹€à¸à¸·à¸­à¸šà¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸',
  observe:  'à¸ªà¸±à¸‡à¹€à¸à¸•à¹€à¸«à¹‡à¸™à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡',
};
const SEV_ICON = {
  accident: 'ğŸš¨', frequent: 'âš ï¸', near: 'âš¡', observe: 'ğŸ‘ï¸'
};

const PLACE_LABEL = {
  intersection:'à¸ªà¸µà¹ˆà¹à¸¢à¸', tjunction:'à¹à¸¢à¸ T', roundabout:'à¸§à¸‡à¹€à¸§à¸µà¸¢à¸™',
  curve:'à¹‚à¸„à¹‰à¸‡à¸–à¸™à¸™', straight:'à¸—à¸²à¸‡à¸•à¸£à¸‡', slope:'à¸—à¸²à¸‡à¸¥à¸²à¸”',
  crosswalk:'à¸—à¸²à¸‡à¸‚à¹‰à¸²à¸¡à¸„à¸™à¹€à¸”à¸´à¸™', school_zone:'à¸«à¸™à¹‰à¸²à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™',
  bridge:'à¸ªà¸°à¸à¸²à¸™', highway:'à¸—à¸²à¸‡à¸«à¸¥à¸§à¸‡', alley:'à¸‹à¸­à¸¢/à¸Šà¸¸à¸¡à¸Šà¸™',
  campus:'à¸ à¸²à¸¢à¹ƒà¸™à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢',
};
const INCIDENT_LABEL = {
  head_on:'à¸£à¸–à¸Šà¸™à¸›à¸£à¸°à¸ªà¸²à¸™à¸‡à¸²', rear_end:'à¸£à¸–à¸Šà¸™à¸—à¹‰à¸²à¸¢', side_swipe:'à¸£à¸–à¸Šà¸™à¸”à¹‰à¸²à¸™à¸‚à¹‰à¸²à¸‡',
  hit_ped:'à¸£à¸–à¸Šà¸™à¸„à¸™à¹€à¸”à¸´à¸™', rollover:'à¸£à¸–à¸à¸¥à¸´à¸à¸„à¸§à¹ˆà¸³', run_off:'à¸£à¸–à¸•à¸à¸–à¸™à¸™',
  fall_slip:'à¸¥à¹‰à¸¡/à¸¥à¸·à¹ˆà¸™', hit_object:'à¸Šà¸™à¸ªà¸´à¹ˆà¸‡à¸à¸µà¸”à¸‚à¸§à¸²à¸‡',
};
const CAUSE_LABEL = {
  speeding:'à¸‚à¸±à¸šà¹€à¸£à¹‡à¸§à¹€à¸à¸´à¸™', drunk:'à¸ªà¸‡à¸ªà¸±à¸¢à¹€à¸¡à¸²à¸ªà¸¸à¸£à¸²', sleepy:'à¸‡à¹ˆà¸§à¸‡/à¹€à¸«à¸¡à¹ˆà¸­à¸¥à¸­à¸¢',
  distracted:'à¹ƒà¸Šà¹‰à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ', red_light:'à¸à¹ˆà¸²à¹„à¸Ÿà¹à¸”à¸‡', no_yield:'à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸”à¹ƒà¸«à¹‰à¸—à¸²à¸‡',
  low_vis:'à¸—à¸±à¸¨à¸™à¸§à¸´à¸ªà¸±à¸¢à¸•à¹ˆà¸³', slippery:'à¸–à¸™à¸™à¸¥à¸·à¹ˆà¸™', no_light:'à¹„à¸Ÿà¸ªà¹ˆà¸­à¸‡à¸ªà¸§à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢',
  road_defect:'à¸–à¸™à¸™à¸Šà¸³à¸£à¸¸à¸”', no_sign:'à¸›à¹‰à¸²à¸¢à¹„à¸¡à¹ˆà¸Šà¸±à¸”', unknown:'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸ªà¸²à¹€à¸«à¸•à¸¸',
};
const VEH_LABEL = {
  motorcycle:'à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ', car:'à¸£à¸–à¸¢à¸™à¸•à¹Œ', truck:'à¸£à¸–à¸šà¸£à¸£à¸—à¸¸à¸',
  bus:'à¸£à¸–à¹‚à¸”à¸¢à¸ªà¸²à¸£', bicycle:'à¸ˆà¸±à¸à¸£à¸¢à¸²à¸™', tricycle:'à¸ªà¸²à¸¡à¸¥à¹‰à¸­',
  pedestrian:'à¸„à¸™à¹€à¸”à¸´à¸™à¹€à¸—à¹‰à¸²', unknown:'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š',
};
const TIME_LABEL = {
  dawn:'à¸£à¸¸à¹ˆà¸‡à¹€à¸Šà¹‰à¸²', morning:'à¸ªà¸²à¸¢', afternoon:'à¸šà¹ˆà¸²à¸¢',
  evening:'à¹€à¸¢à¹‡à¸™', night:'à¸à¸¥à¸²à¸‡à¸„à¸·à¸™', late_night:'à¸”à¸¶à¸',
};

const STEP_LABELS = [
  '',
  'à¸›à¸£à¸°à¹€à¸ à¸—à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸­à¸‡à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ',
  'à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¸¢à¸²à¸™à¸à¸²à¸«à¸™à¸°',
  'à¸£à¸¹à¸›à¹à¸šà¸šà¹€à¸«à¸•à¸¸ à¸ªà¸²à¹€à¸«à¸•à¸¸ à¹à¸¥à¸°à¸à¸¥à¸¸à¹ˆà¸¡à¸œà¸¹à¹‰à¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡',
  'à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡à¹à¸¥à¸°à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸·à¹‰à¸™à¸à¸²à¸™',
  'à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡à¹à¸¥à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™',
];

const BADGE_DEFS = [
  { id:'first',    icon:'ğŸŒ±', name:'à¸à¹‰à¸²à¸§à¹à¸£à¸',        req: n => n >= 1 },
  { id:'explorer', icon:'ğŸ”', name:'à¸™à¸±à¸à¸ªà¸³à¸£à¸§à¸ˆ',       req: n => n >= 5 },
  { id:'guardian', icon:'ğŸ›¡ï¸', name:'à¸œà¸¹à¹‰à¸à¸´à¸—à¸±à¸à¸©à¹Œ',     req: n => n >= 20 },
  { id:'hero',     icon:'â­', name:'à¸§à¸µà¸£à¸šà¸¸à¸£à¸¸à¸©',       req: n => n >= 50 },
  { id:'nearmiss', icon:'âš¡', name:'Near-Miss Pro',   req: _ => APP.reports.filter(r => r.sev==='near').length >= 3 },
  { id:'photo',    icon:'ğŸ“·', name:'à¸™à¸±à¸à¸–à¹ˆà¸²à¸¢à¸ à¸²à¸',     req: _ => APP.reports.some(r => r.hasPhoto) },
  { id:'equity',   icon:'â™¿', name:'Equity Guard',    req: _ => APP.reports.some(r => (r.groups||[]).includes('disabled')) },
  { id:'campus',   icon:'ğŸ“', name:'Campus Safety',   req: _ => APP.reports.some(r => r.reporter_role === 'student') },
];

const LEVELS = [
  { min:0,    max:100,   label:'à¸œà¸¹à¹‰à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™',         icon:'ğŸŒ±' },
  { min:100,  max:300,   label:'à¸™à¸±à¸à¸ªà¸³à¸£à¸§à¸ˆ',             icon:'ğŸ”' },
  { min:300,  max:700,   label:'à¸œà¸¹à¹‰à¸à¸´à¸—à¸±à¸à¸©à¹Œà¸–à¸™à¸™',        icon:'ğŸ›¡ï¸' },
  { min:700,  max:1500,  label:'à¸§à¸µà¸£à¸šà¸¸à¸£à¸¸à¸©à¸–à¸™à¸™',          icon:'â­' },
  { min:1500, max:99999, label:'à¸•à¸³à¸™à¸²à¸™à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢',     icon:'ğŸ†' },
];

const AV_COLORS = ['#1b3a6b','#1a7a4a','#b7560a','#c0392b','#7c3aed','#0e7490'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAP INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const map = L.map('map', { zoomControl: false }).setView([16.82, 100.26], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap contributors',
  maxZoom: 19,
}).addTo(map);

L.control.zoom({ position: 'topright' }).addTo(map);

map.on('click', e => {
  setCoordinate(e.latlng.lat, e.latlng.lng);
  if (!document.getElementById('panel-report').classList.contains('open')) {
    openReportPanel();
  }
});

function buildMarkerIcon(sev) {
  const c = SEV_COLOR[sev] || '#e67e22';
  const i = SEV_ICON[sev]  || 'âš ï¸';
  return L.divIcon({
    className: '',
    html: `<div style="width:34px;height:34px;background:${c};border-radius:50% 50% 50% 0;transform:rotate(-45deg);border:2.5px solid rgba(255,255,255,0.85);box-shadow:0 3px 12px ${c}55,0 1px 4px rgba(0,0,0,0.15);display:flex;align-items:center;justify-content:center">
             <span style="transform:rotate(45deg);font-size:14px;line-height:1">${i}</span>
           </div>`,
    iconSize:   [34, 34],
    iconAnchor: [17, 34],
  });
}

function buildPopupHtml(r) {
  const c     = SEV_COLOR[r.sev] || '#e67e22';
  const tags  = [
    ...(r.vehicles||[]).map(v => VEH_LABEL[v]||v),
    ...(r.causes||[]).slice(0,2).map(v => CAUSE_LABEL[v]||v),
  ].filter(Boolean).slice(0,5);

  return `<div class="map-popup">
    <div class="mp-header">
      <div class="mp-sev-bar" style="background:${c};min-height:32px"></div>
      <div>
        <div class="mp-title">${PLACE_LABEL[r.place]||'à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡'}</div>
        <span class="mp-badge" style="background:${c}18;color:${c}">${SEV_LABEL[r.sev]||r.sev}</span>
      </div>
    </div>
    ${r.incident?`<div style="font-size:11.5px;color:#3d5168;margin-bottom:5px">à¸£à¸¹à¸›à¹à¸šà¸š: ${INCIDENT_LABEL[r.incident]||r.incident}</div>`:''}
    ${tags.length?`<div class="mp-tags">${tags.map(t=>`<span class="mp-tag">${t}</span>`).join('')}</div>`:''}
    ${r.desc?`<div class="mp-desc">${r.desc}</div>`:''}
    <div class="mp-meta">
      ${r.time_label||''} ${r.weather?'Â· '+r.weather:''}<br>
      à¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™: ${r.reporter||'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸'} Â· à¸¢à¸·à¸™à¸¢à¸±à¸™ ${r.votes||0} à¸„à¸£à¸±à¹‰à¸‡
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAP MODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setMapMode(mode) {
  APP.mapMode = mode;

  // Update button states
  ['pin','heat','cluster'].forEach(m => {
    const b = document.getElementById('mb-'+m);
    if (b) b.classList.toggle('active', m === mode);
  });

  // Clear all layers
  APP.pinLayers.forEach(l => { try { map.removeLayer(l); } catch(e){} });
  APP.pinLayers = [];
  if (APP.heatLayer)    { try { map.removeLayer(APP.heatLayer); }    catch(e){} APP.heatLayer = null; }
  if (APP.clusterGroup) { try { map.removeLayer(APP.clusterGroup); } catch(e){} APP.clusterGroup = null; }

  const valid = APP.reports.filter(r => r.lat && r.lng);

  if (mode === 'pin') {
    valid.forEach(r => {
      const m = L.marker([+r.lat, +r.lng], { icon: buildMarkerIcon(r.sev) }).addTo(map);
      m.bindPopup(buildPopupHtml(r), { className:'', maxWidth:290 });
      APP.pinLayers.push(m);
    });

  } else if (mode === 'heat') {
    const weight = { accident:1.0, frequent:0.65, near:0.4, observe:0.25 };
    const pts = valid.map(r => [+r.lat, +r.lng, weight[r.sev]||0.3]);
    if (pts.length) {
      APP.heatLayer = L.heatLayer(pts, {
        radius: 38, blur: 28, maxZoom: 16,
        gradient: { 0.2:'#27ae60', 0.5:'#e67e22', 0.8:'#c0392b', 1.0:'#7f1d1d' },
      }).addTo(map);
    }

  } else if (mode === 'cluster') {
    APP.clusterGroup = L.markerClusterGroup({
      chunkedLoading: true,
      iconCreateFunction: cluster => {
        const n = cluster.getChildCount();
        return L.divIcon({
          html: `<div style="width:40px;height:40px;background:var(--navy);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:13px;font-weight:700;color:white;box-shadow:0 2px 10px rgba(27,58,107,0.3);border:2.5px solid rgba(255,255,255,0.8)">${n}</div>`,
          className: '', iconSize: [40, 40],
        });
      },
    });
    valid.forEach(r => {
      const m = L.marker([+r.lat, +r.lng], { icon: buildMarkerIcon(r.sev) });
      m.bindPopup(buildPopupHtml(r), { maxWidth:290 });
      APP.clusterGroup.addLayer(m);
    });
    map.addLayer(APP.clusterGroup);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getGPS() {
  const btn = document.getElementById('gps-btn');
  btn.classList.add('loading');
  btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="animation:spin 1s linear infinite">
    <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
  </svg> à¸à¸³à¸¥à¸±à¸‡à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡...`;

  if (!navigator.geolocation) {
    resetGPSBtn();
    toast('à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š GPS', 'error');
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => {
      setCoordinate(pos.coords.latitude, pos.coords.longitude);
      map.flyTo([pos.coords.latitude, pos.coords.longitude], 17, { duration: 1.2 });
      btn.classList.remove('loading');
      btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> à¹„à¸”à¹‰à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹à¸¥à¹‰à¸§`;
      toast('à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ GPS à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'success');
    },
    () => { resetGPSBtn(); toast('à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¹à¸•à¸°à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆ', 'error'); },
    { enableHighAccuracy: true, timeout: 12000 }
  );
}

function resetGPSBtn() {
  const btn = document.getElementById('gps-btn');
  btn.classList.remove('loading');
  btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
    <line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/>
    <line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/>
  </svg> à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ GPS`;
}

function doGPS() {
  if (!navigator.geolocation) return;
  navigator.geolocation.getCurrentPosition(
    p => map.flyTo([p.coords.latitude, p.coords.longitude], 17, { duration: 1 }),
    () => toast('à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹„à¸”à¹‰', 'error')
  );
}

function setCoordinate(lat, lng) {
  APP.lat = lat; APP.lng = lng;
  const disp = document.getElementById('coord-display');
  const txt  = document.getElementById('coord-text');
  if (disp) disp.classList.add('set');
  if (txt)  txt.textContent = `${lat.toFixed(5)}, ${lng.toFixed(5)}`;
  if (APP.tempMarker) map.removeLayer(APP.tempMarker);
  APP.tempMarker = L.circleMarker([lat, lng], {
    radius: 8, fillColor: '#1b3a6b', fillOpacity: 0.35,
    color: '#1b3a6b', weight: 2,
  }).addTo(map);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FORM FIELD SELECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectEventType(el) {
  document.querySelectorAll('.event-opt').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  APP.form.sev = el.dataset.sev;
  const injBox = document.getElementById('injury-section');
  if (injBox) injBox.classList.toggle('visible', APP.form.sev === 'accident');
  if (APP.form.sev !== 'accident') delete APP.form.injury;
}

function selSingle(el, field) {
  document.querySelectorAll(`[data-f="${field}"]`).forEach(b => {
    b.classList.remove('selected', 'selected-red');
  });
  el.classList.add('selected');
  APP.form[field] = el.dataset.v;
}

function selMulti(el, field) {
  el.classList.toggle('selected');
  if (!Array.isArray(APP.form[field])) APP.form[field] = [];
  const v = el.dataset.v;
  if (el.classList.contains('selected')) {
    if (!APP.form[field].includes(v)) APP.form[field].push(v);
  } else {
    APP.form[field] = APP.form[field].filter(x => x !== v);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WIZARD NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function wizardNext() {
  // Validation per step
  const v = APP.form;
  if (APP.step === 1) {
    if (!v.sev) return toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸›à¸£à¸°à¹€à¸ à¸—à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ', 'error');
    if (v.sev === 'accident' && !v.injury) return toast('à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸­à¸‡à¸à¸²à¸£à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸š', 'error');
  }
  if (APP.step === 2) {
    if (!APP.lat || !APP.lng) return toast('à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸”à¹‰à¸§à¸¢ GPS à¸«à¸£à¸·à¸­à¹à¸•à¸°à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆ', 'error');
    if (!v.place) return toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸¥à¸±à¸à¸©à¸“à¸°à¸‚à¸­à¸‡à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ', 'error');
  }
  if (APP.step === 3) {
    if (!v.incident) return toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸£à¸¹à¸›à¹à¸šà¸šà¸à¸²à¸£à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸', 'error');
  }
  if (APP.step === 4) {
    if (!v.time_slot) return toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸', 'error');
    if (!v.weather)   return toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸ªà¸ à¸²à¸à¸­à¸²à¸à¸²à¸¨', 'error');
  }
  if (APP.step === TOTAL_STEPS) {
    submitReport();
    return;
  }
  APP.step++;
  renderWizardUI();
}

function wizardBack() {
  if (APP.step <= 1) return;
  APP.step--;
  renderWizardUI();
}

function renderWizardUI() {
  const step = APP.step;

  // Pages
  document.querySelectorAll('.step-page').forEach((p, i) => {
    p.classList.toggle('active', i + 1 === step);
  });

  // Nodes & connectors
  for (let i = 1; i <= TOTAL_STEPS; i++) {
    const node = document.getElementById('sn-' + i);
    node.classList.remove('active', 'done');
    if (i < step) {
      node.classList.add('done');
      node.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`;
    } else if (i === step) {
      node.classList.add('active');
      node.textContent = i;
    } else {
      node.textContent = i;
    }
    if (i < TOTAL_STEPS) {
      const conn = document.getElementById('sc-' + i);
      if (conn) conn.classList.toggle('done', i < step);
    }
  }

  // Labels
  const lbl = document.getElementById('step-label');
  const ctr = document.getElementById('step-counter');
  if (lbl) lbl.textContent = STEP_LABELS[step] || '';
  if (ctr) ctr.textContent = `${step} / ${TOTAL_STEPS}`;

  // Footer buttons
  const back = document.getElementById('wf-back');
  const next = document.getElementById('wf-next');
  if (back) back.style.display = step > 1 ? 'block' : 'none';
  if (next) {
    if (step === TOTAL_STEPS) {
      next.textContent = 'à¸ªà¹ˆà¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™';
      next.className = 'wf-next submit';
    } else {
      next.textContent = 'à¸–à¸±à¸”à¹„à¸› â†’';
      next.className = 'wf-next';
    }
  }

  // Scroll panel body to top
  const body = document.querySelector('#panel-report .panel-body');
  if (body) body.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PHOTO HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handlePhotoUpload(e) {
  const files = Array.from(e.target.files).slice(0, 3);
  APP.photos = files;
  const prev = document.getElementById('photo-previews');
  if (!prev) return;
  prev.innerHTML = '';
  files.forEach(f => {
    const r = new FileReader();
    r.onload = ev => {
      const img = document.createElement('img');
      img.src = ev.target.result;
      img.className = 'photo-thumb animate-in';
      prev.appendChild(img);
    };
    r.readAsDataURL(f);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT REPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitReport() {
  const next = document.getElementById('wf-next');
  next.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...';
  next.classList.add('loading');

  const now    = new Date();
  const report = {
    id:            now.getTime().toString(),
    lat:           APP.lat,
    lng:           APP.lng,
    sev:           APP.form.sev,
    injury:        APP.form.injury        || '',
    place:         APP.form.place         || '',
    vehicles:      APP.form.vehicles      || [],
    incident:      APP.form.incident      || '',
    causes:        APP.form.causes        || [],
    groups:        APP.form.groups        || [],
    infra:         APP.form.infra         || [],
    time_slot:     APP.form.time_slot     || '',
    time_label:    TIME_LABEL[APP.form.time_slot] || '',
    weather:       APP.form.weather       || '',
    day_type:      APP.form.day_type      || '',
    desc:          document.getElementById('inp-desc')?.value.trim() || '',
    reporter:      document.getElementById('inp-name')?.value.trim() || APP.user.name || '',
    reporter_role: APP.form.reporter_role || '',
    hasPhoto:      APP.photos.length > 0,
    votes:         0,
    status:        'pending',
    createdAt:     now.toLocaleString('th-TH', { dateStyle:'short', timeStyle:'short' }),
    timestamp:     now.toISOString(),
  };

  APP.reports.push(report);
  saveLocal();

  // Update map
  setMapMode(APP.mapMode);

  // Points
  let pts = 10;
  if (report.sev === 'near')   pts += 10;
  if (APP.photos.length > 0)   pts += 5;
  addPoints(pts);
  checkBadges();

  // Sync to GAS (non-blocking)
  sendToGAS(report);

  // UI reset
  resetForm();
  next.textContent = 'à¸ªà¹ˆà¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™';
  next.classList.remove('loading');

  updateStats();
  renderList();
  renderLeaderboard();

  toast(`à¸šà¸±à¸™à¸—à¸¶à¸à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ â€” à¹„à¸”à¹‰à¸£à¸±à¸š ${pts} à¸„à¸°à¹à¸™à¸™`, 'success');
  setTimeout(closeAllPanels, 1200);
}

async function sendToGAS(report) {
  if (!GAS_URL || GAS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') return;
  try {
    const fd = new FormData();
    fd.append('action', 'addReport');
    fd.append('data', JSON.stringify(report));
    await fetch(GAS_URL, { method: 'POST', body: fd });
  } catch(e) { /* silent fail â€” data already saved locally */ }
}

function resetForm() {
  APP.form = {}; APP.step = 1;
  APP.photos = []; APP.lat = null; APP.lng = null;

  // Clear selections
  document.querySelectorAll('.event-opt,.opt-card,.pill-opt').forEach(b => {
    b.classList.remove('selected', 'selected-red');
  });

  // Clear injury section
  const injBox = document.getElementById('injury-section');
  if (injBox) injBox.classList.remove('visible');

  // Clear inputs
  const desc = document.getElementById('inp-desc');
  const name = document.getElementById('inp-name');
  if (desc) desc.value = '';
  if (name) name.value = '';

  // Clear coord display
  const disp = document.getElementById('coord-display');
  const txt  = document.getElementById('coord-text');
  if (disp) disp.classList.remove('set');
  if (txt)  txt.textContent = 'à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡';

  // Clear photos
  const prev = document.getElementById('photo-previews');
  if (prev) prev.innerHTML = '';

  // Remove temp marker
  if (APP.tempMarker) { map.removeLayer(APP.tempMarker); APP.tempMarker = null; }

  // Reset GPS button
  resetGPSBtn();

  renderWizardUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VOTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function vote(id, el) {
  const r = APP.reports.find(x => x.id === id);
  if (!r || r._voted) { toast('à¸„à¸¸à¸“à¹„à¸”à¹‰à¸¢à¸·à¸™à¸¢à¸±à¸™à¸£à¸²à¸¢à¸‡à¸²à¸™à¸™à¸µà¹‰à¹à¸¥à¹‰à¸§', 'error'); return; }
  r.votes = (r.votes || 0) + 1;
  r._voted = true;
  el.classList.add('voted');
  el.innerHTML = `âœ“ à¸¢à¸·à¸™à¸¢à¸±à¸™ ${r.votes}`;
  if (r.reporter === APP.user.name) addPoints(5);
  saveLocal();
  renderList();
  updateStats();
  if (GAS_URL && GAS_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
    fetch(GAS_URL, { method:'POST', body: new URLSearchParams({ action:'vote', id }) }).catch(()=>{});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LIST RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderList() {
  const f    = APP.filter;
  const rows = f === 'all' ? APP.reports : APP.reports.filter(r => r.sev === f);
  const body = document.getElementById('list-body');
  const cnt  = document.getElementById('list-count');

  if (cnt) cnt.textContent = `${rows.length} à¸£à¸²à¸¢à¸à¸²à¸£`;

  if (!rows.length) {
    if (body) body.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div class="empty-text">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸²à¸¢à¸‡à¸²à¸™à¹ƒà¸™à¸«à¸¡à¸§à¸”à¸™à¸µà¹‰</div></div>`;
    return;
  }

  if (!body) return;
  body.innerHTML = [...rows].reverse().map(r => {
    const c    = SEV_COLOR[r.sev] || '#e67e22';
    const tags = [
      PLACE_LABEL[r.place]||'',
      ...(r.vehicles||[]).slice(0,2).map(v => VEH_LABEL[v]||v),
      ...(r.causes||[]).slice(0,2).map(v => CAUSE_LABEL[v]||v),
    ].filter(Boolean);

    return `<div class="report-card animate-in" onclick="flyToCard(${r.lat},${r.lng})">
      <div class="rc-severity-bar" style="background:${c}"></div>
      <div class="rc-body">
        <div class="rc-top">
          <div class="rc-type-label">${SEV_ICON[r.sev]} ${PLACE_LABEL[r.place]||'à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡'}</div>
          <span class="rc-sev-badge" style="background:${c}15;color:${c}">${SEV_LABEL[r.sev]||r.sev}</span>
        </div>
        ${tags.length ? `<div class="rc-tags">${tags.map(t=>`<span class="rc-tag">${t}</span>`).join('')}</div>` : ''}
        <div class="rc-desc">${r.desc || (INCIDENT_LABEL[r.incident]||'') || 'à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡'}</div>
        <div class="rc-footer">
          <span>${r.time_label||''}${r.weather?' Â· '+r.weather:''}</span>
          <span>${r.reporter||'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­'}</span>
          <button class="rc-vote-btn ${r._voted?'voted':''}" onclick="event.stopPropagation();vote('${r.id}',this)">
            ${r._voted ? `âœ“ à¸¢à¸·à¸™à¸¢à¸±à¸™ ${r.votes||1}` : `à¸¢à¸·à¸™à¸¢à¸±à¸™ ${r.votes||0}`}
          </button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function filterList(f, el) {
  APP.filter = f;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  renderList();
}

function flyToCard(lat, lng) {
  showView('map');
  setTimeout(() => map.flyTo([lat, lng], 17, { duration: 1 }), 100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATS BAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateStats() {
  const a = APP.reports.filter(r => r.sev === 'accident').length;
  const f = APP.reports.filter(r => r.sev === 'frequent').length;
  const n = APP.reports.filter(r => r.sev === 'near').length;
  const el_a = document.getElementById('h-accident');
  const el_f = document.getElementById('h-frequent');
  const el_n = document.getElementById('h-near');
  if (el_a) el_a.textContent = a;
  if (el_f) el_f.textContent = f;
  if (el_n) el_n.textContent = n;
  const rt = document.getElementById('rank-total');
  if (rt) rt.textContent = APP.reports.length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAMIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addPoints(n) {
  APP.user.pts = (APP.user.pts || 0) + n;
  saveUser();
  updateUserUI();
}

function updateUserUI() {
  const pts  = APP.user.pts;
  const lv   = LEVELS.find(l => pts >= l.min && pts < l.max) || LEVELS[LEVELS.length-1];
  const pct  = Math.min(100, ((pts - lv.min) / (lv.max - lv.min)) * 100);
  const next = LEVELS[LEVELS.indexOf(lv)+1];

  const avatar  = document.getElementById('hdr-avatar');
  const hdrPts  = document.getElementById('hdr-pts');
  const profN   = document.getElementById('prof-name');
  const profLv  = document.getElementById('prof-level');
  const profPts = document.getElementById('prof-pts');
  const profRep = document.getElementById('prof-reps');
  const profVot = document.getElementById('prof-votes-recv');
  const xpFill  = document.getElementById('xp-fill');
  const xpLabel = document.getElementById('xp-label');

  const name = APP.user.name || 'à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™';
  if (avatar) avatar.textContent = name[0].toUpperCase();
  if (hdrPts) hdrPts.textContent = `${pts} à¸„à¸°à¹à¸™à¸™`;

  if (profN)   profN.textContent  = name;
  if (profLv)  profLv.textContent = `à¸£à¸°à¸”à¸±à¸š: ${lv.label} ${lv.icon}`;
  if (profPts) profPts.textContent = pts;
  if (profRep) profRep.textContent = APP.reports.length;
  if (profVot) profVot.textContent = APP.reports.reduce((a,r)=>a+(r.votes||0),0);
  if (xpFill)  xpFill.style.width  = pct + '%';
  if (xpLabel) xpLabel.textContent = `${pts - lv.min} / ${lv.max - lv.min} XP â†’ ${next ? next.label : 'à¸£à¸°à¸”à¸±à¸šà¸ªà¸¹à¸‡à¸ªà¸¸à¸”'}`;
}

function checkBadges() {
  const earned = JSON.parse(localStorage.getItem('sr_badges') || '[]');
  let changed = false;
  BADGE_DEFS.forEach(b => {
    if (!earned.includes(b.id) && b.req(APP.reports.length)) {
      earned.push(b.id);
      changed = true;
      setTimeout(() => toast(`à¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸«à¸£à¸µà¸¢à¸à¸£à¸²à¸‡à¸§à¸±à¸¥: ${b.icon} ${b.name}`, 'success'), 700);
    }
  });
  if (changed) localStorage.setItem('sr_badges', JSON.stringify(earned));
  renderBadges(earned);
}

function renderBadges(earned) {
  const g = document.getElementById('badge-grid');
  if (!g) return;
  g.innerHTML = BADGE_DEFS.map(b => `
    <div class="badge-card ${earned.includes(b.id) ? 'earned' : 'locked'}">
      <span class="badge-card-icon">${b.icon}</span>
      <div class="badge-card-name">${b.name}</div>
    </div>`).join('');
}

function saveName() {
  const n = document.getElementById('edit-name')?.value.trim();
  if (!n) return toast('à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­', 'error');
  APP.user.name = n;
  saveUser();
  updateUserUI();
  toast('à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¸·à¹ˆà¸­à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LEADERBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLeaderboard() {
  const byName = {};
  APP.reports.forEach(r => {
    const k = r.reporter || 'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­';
    if (!byName[k]) byName[k] = { name:k, role:r.reporter_role||'', pts:0, cnt:0 };
    byName[k].pts += 10 + (r.sev==='near'?10:0) + (r.hasPhoto?5:0);
    byName[k].cnt++;
  });
  const sorted = Object.values(byName).sort((a,b) => b.pts - a.pts);
  const body   = document.getElementById('lb-body');
  if (!body) return;

  if (!sorted.length) {
    body.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ†</div><div class="empty-text">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¹à¹‰à¸£à¸²à¸¢à¸‡à¸²à¸™</div></div>`;
    return;
  }

  const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  body.innerHTML = sorted.map((u, i) => `
    <div class="lb-card">
      <div class="lb-rank">${medals[i] || (i+1)}</div>
      <div class="lb-avatar" style="background:${AV_COLORS[i % AV_COLORS.length]}">${u.name[0].toUpperCase()}</div>
      <div class="lb-info">
        <div class="lb-name">${u.name}</div>
        <div class="lb-sub">${u.role||'à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™'} Â· ${u.cnt} à¸£à¸²à¸¢à¸‡à¸²à¸™</div>
      </div>
      <div class="lb-pts">${u.pts}</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOCAL STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveLocal() { localStorage.setItem('sr_v4_reports', JSON.stringify(APP.reports)); }
function saveUser()  { localStorage.setItem('sr_v4_user',    JSON.stringify(APP.user)); }

function loadLocal() {
  const r = localStorage.getItem('sr_v4_reports');
  if (r) APP.reports = JSON.parse(r);
  const u = localStorage.getItem('sr_v4_user');
  if (u) Object.assign(APP.user, JSON.parse(u));
  const n = document.getElementById('edit-name');
  if (n) n.value = APP.user.name || '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PANEL & VIEW NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openReportPanel() {
  closeAllPanels();
  document.getElementById('panel-report').classList.add('open');
  document.getElementById('overlay').classList.add('open');
  document.getElementById('wizard-footer').classList.add('active');
}

function openPanel(name) {
  closeAllPanels();
  const p = document.getElementById('panel-' + name);
  if (p) p.classList.add('open');
  document.getElementById('overlay').classList.add('open');
}

function closeAllPanels() {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('open'));
  document.getElementById('overlay').classList.remove('open');
  document.getElementById('wizard-footer').classList.remove('active');
}

function showView(name, el) {
  const views = ['list','rank'];
  views.forEach(v => {
    const fv = document.getElementById('fv-' + v);
    if (fv) fv.classList.toggle('open', v === name);
  });
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  if (el && el.classList.contains('nav-item')) {
    el.classList.add('active');
  } else {
    const map_ids = { map:'ni-map', list:'ni-list', rank:'ni-rank' };
    const ni = document.getElementById(map_ids[name]);
    if (ni) ni.classList.add('active');
  }
  if (name === 'list') renderList();
  if (name === 'rank') renderLeaderboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type = '') {
  const el = document.getElementById('toast');
  if (!el) return;
  el.textContent = msg;
  el.className = 'toast' + (type ? ' ' + type : '');
  el.classList.add('show');
  clearTimeout(el._t);
  el._t = setTimeout(() => el.classList.remove('show'), 3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEMO DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadDemoData() {
  const demos = [
    {
      lat:16.8233, lng:100.2641, sev:'accident', injury:'minor',
      place:'intersection', vehicles:['motorcycle','car'],
      incident:'head_on', causes:['speeding','red_light'], groups:['student'],
      infra:['no_signal'], time_slot:'evening', time_label:'à¹€à¸¢à¹‡à¸™',
      weather:'clear', day_type:'weekday',
      desc:'à¸£à¸–à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œà¸Šà¸™à¸£à¸–à¸¢à¸™à¸•à¹Œà¸—à¸µà¹ˆà¹à¸¢à¸ à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸±à¸à¸à¸²à¸“à¹„à¸Ÿà¸ˆà¸£à¸²à¸ˆà¸£ à¸œà¸¹à¹‰à¸‚à¸±à¸šà¸‚à¸µà¹ˆà¸šà¸²à¸”à¹€à¸ˆà¹‡à¸šà¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢',
      reporter:'à¸§à¸´à¸—à¸¢à¸² à¸›à¸²à¸™à¸—à¸­à¸‡', reporter_role:'student', votes:7
    },
    {
      lat:16.8312, lng:100.2714, sev:'frequent', place:'curve',
      vehicles:['motorcycle'], incident:'fall_slip',
      causes:['slippery','no_sign'], groups:['student'],
      infra:['no_sign','faded_marking'], time_slot:'night', time_label:'à¸à¸¥à¸²à¸‡à¸„à¸·à¸™',
      weather:'rain', day_type:'weekday',
      desc:'à¹‚à¸„à¹‰à¸‡à¸­à¸±à¸™à¸•à¸£à¸²à¸¢ à¸–à¸™à¸™à¸¥à¸·à¹ˆà¸™à¹€à¸¡à¸·à¹ˆà¸­à¸à¸™à¸•à¸ à¸¡à¸µà¸œà¸¹à¹‰à¸›à¸£à¸°à¸ªà¸šà¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¸šà¹ˆà¸­à¸¢à¸„à¸£à¸±à¹‰à¸‡ à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¹‰à¸²à¸¢à¹€à¸•à¸·à¸­à¸™',
      reporter:'à¸ªà¸¡à¸«à¸¡à¸²à¸¢ à¸„à¸³à¸”à¸µ', reporter_role:'staff', votes:4
    },
    {
      lat:16.8152, lng:100.2553, sev:'near', place:'crosswalk',
      vehicles:['car','pedestrian'], incident:'hit_ped',
      causes:['low_vis','faded_marking'], groups:['elderly','student'],
      infra:['faded_marking','no_sign'], time_slot:'dawn', time_label:'à¸£à¸¸à¹ˆà¸‡à¹€à¸Šà¹‰à¸²',
      weather:'fog', day_type:'weekday',
      desc:'à¸—à¸²à¸‡à¸‚à¹‰à¸²à¸¡à¸„à¸™à¹€à¸”à¸´à¸™à¹€à¸ªà¹‰à¸™à¸ˆà¸£à¸²à¸ˆà¸£à¸¥à¸š à¸«à¸¡à¸­à¸à¸«à¸™à¸² à¸£à¸–à¹à¸¥à¹ˆà¸™à¸œà¹ˆà¸²à¸™à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸” à¹€à¸à¸·à¸­à¸šà¸Šà¸™à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸',
      reporter:'à¸™à¸ à¸²à¸à¸£ à¸ªà¸¡à¹ƒà¸ˆ', reporter_role:'staff', votes:5
    },
    {
      lat:16.8281, lng:100.2462, sev:'observe', place:'straight',
      vehicles:['motorcycle'], incident:'run_off',
      causes:['no_light','road_defect'], groups:['general'],
      infra:['pothole','no_light'], time_slot:'night', time_label:'à¸à¸¥à¸²à¸‡à¸„à¸·à¸™',
      weather:'overcast', day_type:'weekday',
      desc:'à¸šà¹ˆà¸­à¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆà¸à¸¥à¸²à¸‡à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¸ˆà¸£à¸²à¸ˆà¸£ à¹„à¸Ÿà¸–à¸™à¸™à¸”à¸±à¸š à¸¡à¸­à¸‡à¹„à¸¡à¹ˆà¹€à¸«à¹‡à¸™ à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸•à¹ˆà¸­à¸à¸²à¸£à¹€à¸à¸´à¸”à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸à¸¡à¸²à¸',
      reporter:'à¸›à¸£à¸°à¸Šà¸² à¸¡à¸±à¹ˆà¸™à¸„à¸‡', reporter_role:'public', votes:3
    },
    {
      lat:16.8197, lng:100.2698, sev:'accident', injury:'serious',
      place:'campus', vehicles:['motorcycle','bicycle'],
      incident:'side_swipe', causes:['speeding'], groups:['student','disabled'],
      infra:['no_sign','no_ramp'], time_slot:'morning', time_label:'à¸ªà¸²à¸¢',
      weather:'clear', day_type:'weekday',
      desc:'à¸£à¸–à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œà¸‚à¸±à¸šà¹€à¸£à¹‡à¸§à¹ƒà¸™à¹€à¸‚à¸•à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢ à¸Šà¸™à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²à¸—à¸µà¹ˆà¸‚à¸µà¹ˆà¸ˆà¸±à¸à¸£à¸¢à¸²à¸™ à¸šà¸²à¸”à¹€à¸ˆà¹‡à¸šà¸ªà¸²à¸«à¸±à¸ª',
      reporter:'à¸¡à¸±à¸¥à¸¥à¸´à¸à¸² à¸£à¸±à¸à¸©à¸²', reporter_role:'student', votes:9
    },
  ];

  demos.forEach((d, i) => {
    APP.reports.push({
      id: 'demo_' + i,
      ...d,
      hasPhoto: false,
      status: i === 0 ? 'verified' : 'pending',
      createdAt: new Date(Date.now() - i * 86400000).toLocaleString('th-TH', { dateStyle:'short', timeStyle:'short' }),
      timestamp: new Date(Date.now() - i * 86400000).toISOString(),
    });
  });
  saveLocal();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  loadLocal();
  if (APP.reports.length === 0) loadDemoData();

  updateUserUI();
  updateStats();
  setMapMode('pin');
  renderList();
  renderLeaderboard();

  const badges = JSON.parse(localStorage.getItem('sr_badges') || '[]');
  renderBadges(badges);

  // Try GAS sync
  if (GAS_URL && GAS_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
    fetch(`${GAS_URL}?action=getReports`)
      .then(r => r.json())
      .then(json => {
        if (!json.data) return;
        const existing = new Set(APP.reports.map(r => r.id));
        json.data.forEach(r => {
          if (!existing.has(r.id)) APP.reports.push(r);
        });
        saveLocal();
        setMapMode(APP.mapMode);
        updateStats();
        renderList();
        renderLeaderboard();
      })
      .catch(() => {});
  }
}

init();
</script>
</body>
</html>
